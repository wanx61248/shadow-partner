<!DOCTYPE html>
<!-- saved from url=(0059)file:///Users/wanxing/Downloads/ShadowPartner/index3.0.html -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowPartner 10.1 - 模块化深度版</title>
    <script src="./并保存_files/saved_resource"></script>
    <style>
        /* ============================================================
           模块 0：UI 全局空间指标 (Layout & Tokens)
           ============================================================ */
        
         :root {
            --nav-height: 110px;
            --container-max-width: 420px;
            --accent-blue: #07C160;
            --accent-blue-hover: #06AD56;
            --wechat-green: #07C160;
            --wechat-green-light: #38D97F;
            --wechat-green-dark: #06AD56;
            --glass-bg: rgba(25, 25, 27, 0.85);
            --glass-border: rgba(255, 255, 255, 0.08);
            --card-hover-bg: rgba(35, 35, 37, 0.9);
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #000000 0%, #0a0a0a 100%);
            color: #fff;
            font-family: -apple-system, "SF Pro Display", "PingFang SC", sans-serif;
            overflow: hidden;
        }
        /* 灵动岛状态提示 */
        
        .status-island {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            background: var(--glass-bg);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            opacity: 0;
            transform: translate(-50%, -20px);
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .status-island.active {
            opacity: 1;
            transform: translate(-50%, 0);
            pointer-events: auto;
        }
        
        .status-island-icon {
            width: 22px;
            height: 22px;
            flex-shrink: 0;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .status-island-text {
            font-size: 12px;
            font-weight: 600;
            color: #e4e4e7;
        }
        /* AI提取结果样式 */
        
        .ai-extract-result {
            font-size: 11px;
            color: #22c55e;
            font-style: italic;
            margin-top: 8px;
            line-height: 1.5;
            padding-left: 4px;
        }
        
        .ai-extract-result::before {
            content: "✨ ";
            margin-right: 4px;
        }
        
        .view-section {
            position: absolute;
            inset: 0;
            padding: 64px 24px var(--nav-height) 24px;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .hidden-view {
            opacity: 0;
            transform: translateY(20px) scale(0.98);
            pointer-events: none;
            filter: blur(4px);
        }
        
        .active-view {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
            filter: blur(0);
        }
        
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .glass-card:hover {
            background: var(--card-hover-bg);
            border-color: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        
        .task-item {
            animation: slideInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) backwards;
        }
        
        .task-item:nth-child(1) {
            animation-delay: 0.1s;
        }
        
        .task-item:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .task-item:nth-child(3) {
            animation-delay: 0.3s;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .nav-mask {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 160px;
            background: linear-gradient(to top, #000 40%, transparent 100%);
            pointer-events: none;
            z-index: 90;
        }
        
        .avatar-box {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            object-fit: cover;
            flex-shrink: 0;
            background: linear-gradient(135deg, #1c1c1e 0%, #2a2a2c 100%);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        /* 按钮优化 */
        
        button {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        button:hover {
            transform: translateY(-1px);
        }
        
        button:active {
            transform: translateY(0) scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--wechat-green) 0%, var(--wechat-green-dark) 100%);
            box-shadow: 0 4px 16px rgba(7, 193, 96, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--wechat-green-dark) 0%, #059A4A 100%);
            box-shadow: 0 6px 20px rgba(7, 193, 96, 0.4);
        }
        
        .btn-secondary {
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.03);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
        }
        
        .btn-ghost {
            background: rgba(39, 39, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .btn-ghost:hover {
            background: rgba(39, 39, 42, 1);
            border-color: rgba(255, 255, 255, 0.1);
        }
        /* 导航图标优化 */
        
        .nav-icon {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 8px;
            border-radius: 12px;
        }
        
        .nav-icon:hover {
            opacity: 1 !important;
            background: rgba(255, 255, 255, 0.05);
            transform: scale(1.1);
        }
        
        .nav-icon.active {
            opacity: 1 !important;
            background: rgba(255, 255, 255, 0.1);
        }
        /* 主按钮优化 */
        
        #main-action-btn {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(255, 255, 255, 0.15);
        }
        
        #main-action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 32px rgba(255, 255, 255, 0.2);
        }
        
        #main-action-btn:active {
            transform: scale(0.95);
        }
        /* 主按钮图标切换动画 */
        
        .main-icon {
            position: absolute;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .main-icon.hidden {
            opacity: 0;
            transform: scale(0.8) rotate(-90deg);
            pointer-events: none;
        }
        
        .main-icon:not(.hidden) {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }
        /* 知识资产卡片优化 */
        
        .asset-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .asset-card:hover {
            transform: translateX(4px);
            border-left-width: 3px;
        }
        
        .asset-card.expanded {
            border-left-width: 4px;
        }
        
        .asset-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .asset-title {
            font-size: 13px;
            font-weight: 700;
            color: #e4e4e7;
            flex: 1;
        }
        
        .asset-badge {
            font-size: 9px;
            color: #71717a;
            background: rgba(39, 39, 42, 0.5);
            padding: 3px 8px;
            border-radius: 9999px;
            margin-left: 8px;
        }
        
        .asset-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .asset-section:first-of-type {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
        }
        
        .asset-section-title {
            font-size: 10px;
            font-weight: 700;
            color: var(--accent-blue);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .asset-section-content {
            font-size: 11px;
            color: #a1a1aa;
            line-height: 1.6;
        }
        
        .asset-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 6px;
        }
        
        .asset-keyword {
            font-size: 10px;
            color: #d4d4d8;
            background: rgba(0, 122, 255, 0.1);
            border: 1px solid rgba(0, 122, 255, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        
        .asset-keyword:hover {
            background: rgba(0, 122, 255, 0.2);
            border-color: rgba(0, 122, 255, 0.4);
        }
        
        .asset-expand-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .asset-expand-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .asset-expand-btn svg {
            transition: transform 0.3s ease;
        }
        
        .asset-expand-btn.expanded svg {
            transform: rotate(180deg);
        }
        
        .asset-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease, margin-top 0.3s ease;
            opacity: 0;
            margin-top: 0;
        }
        
        .asset-details.expanded {
            max-height: 2000px;
            opacity: 1;
            margin-top: 12px;
        }
        /* 优化资产卡片间距 */
        
        #assets-list {
            padding-bottom: 20px;
        }
        /* 日志时间线优化 */
        
        .log-item {
            transition: all 0.2s ease;
        }
        
        .log-item:hover {
            transform: translateX(4px);
        }
        
        .log-dot {
            transition: all 0.3s ease;
            box-shadow: 0 0 0 0 rgba(7, 193, 96, 0.4);
        }
        
        .log-item:hover .log-dot {
            box-shadow: 0 0 0 8px rgba(7, 193, 96, 0.1);
            transform: scale(1.2);
        }
        /* 日期选择器优化 */
        
        .date-chip {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .date-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .date-chip.active {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            color: #000;
            box-shadow: 0 4px 16px rgba(255, 255, 255, 0.2);
        }
        /* 空状态优化 */
        
        #chat-empty {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* 滚动条优化 */
        
         ::-webkit-scrollbar {
            width: 4px;
        }
        
         ::-webkit-scrollbar-track {
            background: transparent;
        }
        
         ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
        
         ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        /* 隐藏滚动条但保持滚动功能 */
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        /* 脉冲动画优化 */
        
        @keyframes pulse {
            0%,
            100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        /* 改进任务计数显示 */
        
        #task-count {
            color: var(--accent-blue);
            font-weight: 900;
        }
        /* 上传按钮样式 */
        
        .upload-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .upload-btn:hover {
            background: var(--card-hover-bg);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(7, 193, 96, 0.2);
        }
        
        .upload-btn:active {
            transform: translateY(0) scale(0.98);
        }
        
        .upload-btn svg {
            transition: transform 0.2s ease;
        }
        
        .upload-btn:hover svg {
            transform: translateY(-2px);
        }
        /* 日历弹窗样式 */
        
        #calendar-modal {
            animation: fadeIn 0.3s ease;
        }
        
        .calendar-day {
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-day:hover:not(.bg-white) {
            transform: scale(1.1);
        }
        /* 点击日历弹窗外部关闭 */
        
        #calendar-modal>div {
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        /* 点击外部关闭日历 */
        
        #calendar-modal::before {
            content: '';
            position: absolute;
            inset: 0;
            z-index: -1;
        }
        /* 聊天视图灵动岛样式 */
        
        #chat-status-island {
            animation: slideDown 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #ai-status-text,
        #ai-status-subtext {
            transition: opacity 0.3s ease;
        }
        /* AI数字分身效果 */
        
        .ai-avatar-container {
            position: relative;
        }
        
        .ai-avatar {
            animation: float 3s ease-in-out infinite, pulse-glow 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(7, 193, 96, 0.4), 0 0 40px rgba(7, 193, 96, 0.2);
            position: relative;
        }
        
        .ai-scanline {
            background: linear-gradient( to bottom, transparent 0%, rgba(7, 193, 96, 0.3) 50%, transparent 100%);
            animation: scan 3s linear infinite;
            pointer-events: none;
        }
        
        .ai-particles {
            background-image: radial-gradient(2px 2px at 20% 30%, rgba(7, 193, 96, 0.6), transparent), radial-gradient(2px 2px at 60% 70%, rgba(56, 217, 127, 0.5), transparent), radial-gradient(1px 1px at 50% 50%, rgba(7, 193, 96, 0.4), transparent);
            background-size: 100% 100%;
            animation: particles-float 4s ease-in-out infinite;
            opacity: 0.6;
            pointer-events: none;
        }
        
        .ai-glow {
            box-shadow: 0 0 10px rgba(7, 193, 96, 0.6), 0 0 20px rgba(7, 193, 96, 0.4), inset 0 0 10px rgba(7, 193, 96, 0.2);
            animation: glow-pulse 2s ease-in-out infinite;
        }
        
        .ai-status-dot {
            box-shadow: 0 0 8px rgba(7, 193, 96, 0.8);
        }
        
        @keyframes float {
            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-4px) rotate(2deg);
            }
        }
        
        @keyframes pulse-glow {
            0%,
            100% {
                box-shadow: 0 0 20px rgba(7, 193, 96, 0.4), 0 0 40px rgba(7, 193, 96, 0.2);
            }
            50% {
                box-shadow: 0 0 30px rgba(7, 193, 96, 0.6), 0 0 60px rgba(7, 193, 96, 0.3);
            }
        }
        
        @keyframes scan {
            0% {
                transform: translateY(-100%);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(100%);
                opacity: 0;
            }
        }
        
        @keyframes particles-float {
            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }
            33% {
                transform: translate(2px, -2px) scale(1.1);
            }
            66% {
                transform: translate(-2px, 2px) scale(0.9);
            }
        }
        
        @keyframes glow-pulse {
            0%,
            100% {
                opacity: 0.8;
            }
            50% {
                opacity: 1;
            }
        }
        /* 微信绿色主题优化 */
        
        .btn-primary {
            background: linear-gradient(135deg, var(--wechat-green) 0%, var(--wechat-green-dark) 100%);
            box-shadow: 0 4px 16px rgba(7, 193, 96, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--wechat-green-dark) 0%, #059A4A 100%);
            box-shadow: 0 6px 20px rgba(7, 193, 96, 0.4);
        }
        /* 任务与日程样式 */
        
        .task-filter-btn {
            background: rgba(39, 39, 42, 0.8);
            color: #a1a1aa;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .task-filter-btn.active {
            background: var(--wechat-green);
            color: white;
            border-color: var(--wechat-green);
        }
        
        .task-filter-btn:hover:not(.active) {
            background: rgba(39, 39, 42, 1);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .task-card {
            transition: all 0.3s ease;
        }
        
        .task-card:hover {
            transform: translateX(2px);
            background: var(--card-hover-bg);
        }
        
        .task-status-badge {
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 600;
        }
        
        .task-status-pending {
            background: rgba(234, 179, 8, 0.15);
            color: #fbbf24;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }
        
        .task-status-progress {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .task-status-completed {
            background: rgba(7, 193, 96, 0.15);
            color: var(--wechat-green);
            border: 1px solid rgba(7, 193, 96, 0.3);
        }
        
        .task-urgent {
            border-left: 4px solid #ef4444;
        }
        
        .task-conflict {
            border-left: 4px solid #f59e0b;
        }
        
        .task-due-time {
            font-size: 10px;
            color: #71717a;
        }
        
        .task-due-time.urgent {
            color: #ef4444;
            font-weight: 600;
        }
        /* 微信对话呼吸感增强 */
        
        .chat-bubble {
            animation: breathe 4s ease-in-out infinite;
        }
        
        .chat-bubble:nth-child(1) {
            animation-delay: 0s;
        }
        
        .chat-bubble:nth-child(2) {
            animation-delay: 0.5s;
        }
        
        .chat-bubble:nth-child(3) {
            animation-delay: 1s;
        }
        
        @keyframes breathe {
            0%,
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            50% {
                opacity: 0.95;
                transform: translateY(-2px) scale(1.01);
            }
        }
        
        .chat-avatar {
            animation: avatar-pulse 3s ease-in-out infinite;
        }
        
        @keyframes avatar-pulse {
            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 6px 20px rgba(7, 193, 96, 0.3);
            }
        }
        
        .chat-message-card {
            animation: card-glow 5s ease-in-out infinite;
            position: relative;
        }
        
        .chat-message-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 20px;
            padding: 1px;
            background: linear-gradient(135deg, rgba(7, 193, 96, 0.1), rgba(7, 193, 96, 0));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0;
            animation: border-glow 4s ease-in-out infinite;
        }
        
        @keyframes card-glow {
            0%,
            100% {
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            }
            50% {
                box-shadow: 0 12px 40px rgba(7, 193, 96, 0.15);
            }
        }
        
        @keyframes border-glow {
            0%,
            100% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }
        /* 日志页面状态卡片样式 */
        
        #log-status-island {
            animation: slideDown 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        #log-ai-status-text,
        #log-ai-status-subtext {
            transition: opacity 0.3s ease;
        }
        /* 文件拖拽上传样式 */
        
        #file-drop-zone {
            transition: all 0.3s ease;
        }
        
        #file-drop-zone.drag-over {
            border-color: var(--wechat-green);
            background: rgba(7, 193, 96, 0.05);
        }
        
        #file-drop-zone.uploading {
            border-color: var(--wechat-green);
        }
        /* 语音输入波形动画 */
        
        .voice-wave-bar {
            width: 3px;
            background: var(--wechat-green);
            border-radius: 2px;
            animation: wave 1s ease-in-out infinite;
        }
        
        .voice-wave-bar:nth-child(1) {
            animation-delay: 0s;
            height: 8px;
        }
        
        .voice-wave-bar:nth-child(2) {
            animation-delay: 0.1s;
            height: 12px;
        }
        
        .voice-wave-bar:nth-child(3) {
            animation-delay: 0.2s;
            height: 16px;
        }
        
        .voice-wave-bar:nth-child(4) {
            animation-delay: 0.3s;
            height: 12px;
        }
        
        .voice-wave-bar:nth-child(5) {
            animation-delay: 0.4s;
            height: 8px;
        }
        
        .voice-wave-bar:nth-child(6) {
            animation-delay: 0.5s;
            height: 12px;
        }
        
        .voice-wave-bar:nth-child(7) {
            animation-delay: 0.6s;
            height: 16px;
        }
        
        .voice-wave-bar:nth-child(8) {
            animation-delay: 0.7s;
            height: 12px;
        }
        
        @keyframes wave {
            0%,
            100% {
                transform: scaleY(0.5);
                opacity: 0.5;
            }
            50% {
                transform: scaleY(1);
                opacity: 1;
            }
        }
        /* 输入框自动调整高度 */
        
        #chat-text-input {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }
        
        #chat-text-input::-webkit-scrollbar {
            width: 4px;
        }
        
        #chat-text-input::-webkit-scrollbar-track {
            background: transparent;
        }
        
        #chat-text-input::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }
        /* 微信回复框动画 */
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(100%);
                opacity: 0;
            }
        }
        
        #wechat-reply-box {
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
        }
        /* 回复框输入框自动调整高度 */
        
        #wechat-text-input {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }
        
        #wechat-text-input::-webkit-scrollbar {
            width: 4px;
        }
        
        #wechat-text-input::-webkit-scrollbar-track {
            background: transparent;
        }
        
        #wechat-text-input::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.pointer-events-none{pointer-events:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.inset-x-0{left:0px;right:0px}.-left-\[25px\]{left:-25px}.-right-0\.5{right:-0.125rem}.-right-1{right:-0.25rem}.-top-0\.5{top:-0.125rem}.-top-1{top:-0.25rem}.bottom-0{bottom:0px}.left-0{left:0px}.right-0{right:0px}.right-2{right:0.5rem}.right-4{right:1rem}.top-1{top:0.25rem}.top-1\/2{top:50%}.top-4{top:1rem}.z-10{z-index:10}.z-\[100\]{z-index:100}.z-\[200\]{z-index:200}.mx-4{margin-left:1rem;margin-right:1rem}.mx-auto{margin-left:auto;margin-right:auto}.-mt-10{margin-top:-2.5rem}.mb-0\.5{margin-bottom:0.125rem}.mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-5{margin-bottom:1.25rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-2{margin-left:0.5rem}.mr-1{margin-right:0.25rem}.mt-1\.5{margin-top:0.375rem}.mt-2{margin-top:0.5rem}.mt-3{margin-top:0.75rem}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.hidden{display:none}.h-1{height:0.25rem}.h-10{height:2.5rem}.h-11{height:2.75rem}.h-12{height:3rem}.h-14{height:3.5rem}.h-16{height:4rem}.h-2{height:0.5rem}.h-2\.5{height:0.625rem}.h-3{height:0.75rem}.h-3\.5{height:0.875rem}.h-4{height:1rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-\[var\(--nav-height\)\]{height:var(--nav-height)}.h-full{height:100%}.h-screen{height:100vh}.max-h-\[120px\]{max-height:120px}.min-h-\[40px\]{min-height:40px}.w-10{width:2.5rem}.w-11{width:2.75rem}.w-12{width:3rem}.w-14{width:3.5rem}.w-16{width:4rem}.w-2{width:0.5rem}.w-2\.5{width:0.625rem}.w-3{width:0.75rem}.w-3\.5{width:0.875rem}.w-4{width:1rem}.w-6{width:1.5rem}.w-8{width:2rem}.w-full{width:100%}.max-w-\[var\(--container-max-width\)\]{max-width:var(--container-max-width)}.max-w-sm{max-width:24rem}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.-translate-y-1\/2{--tw-translate-y:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes ping{75%, 100%{transform:scale(2);opacity:0}}.animate-ping{animation:ping 1s cubic-bezier(0, 0, 0.2, 1) infinite}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.cursor-pointer{cursor:pointer}.resize-none{resize:none}.grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:0.25rem}.gap-2{gap:0.5rem}.gap-2\.5{gap:0.625rem}.gap-3{gap:0.75rem}.space-x-1\.5 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.375rem * var(--tw-space-x-reverse));margin-left:calc(0.375rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-3 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.75rem * var(--tw-space-x-reverse));margin-left:calc(0.75rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-8 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-4{border-width:4px}.border-x{border-left-width:1px;border-right-width:1px}.border-l-2{border-left-width:2px}.border-l-4{border-left-width:4px}.border-t{border-top-width:1px}.border-\[var\(--wechat-green\)\]{border-color:var(--wechat-green)}.border-black{--tw-border-opacity:1;border-color:rgb(0 0 0 / var(--tw-border-opacity, 1))}.border-blue-500{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.border-red-500\/30{border-color:rgb(239 68 68 / 0.3)}.border-white\/10{border-color:rgb(255 255 255 / 0.1)}.border-white\/5{border-color:rgb(255 255 255 / 0.05)}.border-yellow-500{--tw-border-opacity:1;border-color:rgb(234 179 8 / var(--tw-border-opacity, 1))}.border-zinc-700\/50{border-color:rgb(63 63 70 / 0.5)}.border-zinc-800\/50{border-color:rgb(39 39 42 / 0.5)}.border-zinc-900{--tw-border-opacity:1;border-color:rgb(24 24 27 / var(--tw-border-opacity, 1))}.border-zinc-700\/30{border-color:rgb(63 63 70 / 0.3)}.bg-\[var\(--accent-blue\)\]{background-color:var(--accent-blue)}.bg-\[var\(--wechat-green\)\]{background-color:var(--wechat-green)}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-black\/80{background-color:rgb(0 0 0 / 0.8)}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-red-500\/10{background-color:rgb(239 68 68 / 0.1)}.bg-red-500\/20{background-color:rgb(239 68 68 / 0.2)}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/10{background-color:rgb(255 255 255 / 0.1)}.bg-white\/5{background-color:rgb(255 255 255 / 0.05)}.bg-zinc-700{--tw-bg-opacity:1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}.bg-zinc-700\/50{background-color:rgb(63 63 70 / 0.5)}.bg-zinc-800{--tw-bg-opacity:1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}.bg-zinc-900\/50{background-color:rgb(24 24 27 / 0.5)}.bg-zinc-900\/80{background-color:rgb(24 24 27 / 0.8)}.bg-blue-500\/20{background-color:rgb(59 130 246 / 0.2)}.bg-gradient-to-br{background-image:linear-gradient(to bottom right, var(--tw-gradient-stops))}.from-\[var\(--wechat-green\)\]{--tw-gradient-from:var(--wechat-green) var(--tw-gradient-from-position);--tw-gradient-to:rgb(255 255 255 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.via-\[var\(--wechat-green-light\)\]{--tw-gradient-to:rgb(255 255 255 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--wechat-green-light) var(--tw-gradient-via-position), var(--tw-gradient-to)}.to-\[var\(--wechat-green-dark\)\]{--tw-gradient-to:var(--wechat-green-dark) var(--tw-gradient-to-position)}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.px-12{padding-left:3rem;padding-right:3rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-1\.5{padding-top:0.375rem;padding-bottom:0.375rem}.py-16{padding-top:4rem;padding-bottom:4rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-2\.5{padding-top:0.625rem;padding-bottom:0.625rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-32{padding-top:8rem;padding-bottom:8rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pb-2{padding-bottom:0.5rem}.pb-8{padding-bottom:2rem}.pl-4{padding-left:1rem}.pr-10{padding-right:2.5rem}.pt-3{padding-top:0.75rem}.text-center{text-align:center}.text-right{text-align:right}.text-2xl{font-size:1.5rem;line-height:2rem}.text-\[10px\]{font-size:10px}.text-\[11px\]{font-size:11px}.text-\[12px\]{font-size:12px}.text-\[13px\]{font-size:13px}.text-\[14px\]{font-size:14px}.text-\[9px\]{font-size:9px}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-black{font-weight:900}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.italic{font-style:italic}.leading-relaxed{line-height:1.625}.leading-tight{line-height:1.25}.tracking-tight{letter-spacing:-0.025em}.tracking-tighter{letter-spacing:-0.05em}.tracking-wider{letter-spacing:0.05em}.tracking-widest{letter-spacing:0.1em}.text-\[var\(--wechat-green\)\]{color:var(--wechat-green)}.text-black{--tw-text-opacity:1;color:rgb(0 0 0 / var(--tw-text-opacity, 1))}.text-blue-500{--tw-text-opacity:1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.text-purple-500{--tw-text-opacity:1;color:rgb(168 85 247 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity:1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-500{--tw-text-opacity:1;color:rgb(234 179 8 / var(--tw-text-opacity, 1))}.text-zinc-200{--tw-text-opacity:1;color:rgb(228 228 231 / var(--tw-text-opacity, 1))}.text-zinc-300{--tw-text-opacity:1;color:rgb(212 212 216 / var(--tw-text-opacity, 1))}.text-zinc-400{--tw-text-opacity:1;color:rgb(161 161 170 / var(--tw-text-opacity, 1))}.text-zinc-500{--tw-text-opacity:1;color:rgb(113 113 122 / var(--tw-text-opacity, 1))}.text-zinc-600{--tw-text-opacity:1;color:rgb(82 82 91 / var(--tw-text-opacity, 1))}.text-zinc-700{--tw-text-opacity:1;color:rgb(63 63 70 / var(--tw-text-opacity, 1))}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.line-through{-webkit-text-decoration-line:line-through;text-decoration-line:line-through}.placeholder-zinc-400::placeholder{--tw-placeholder-opacity:1;color:rgb(161 161 170 / var(--tw-placeholder-opacity, 1))}.opacity-40{opacity:0.4}.opacity-50{opacity:0.5}.opacity-75{opacity:0.75}.opacity-60{opacity:0.6}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.backdrop-blur-lg{--tw-backdrop-blur:blur(16px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.duration-500{transition-duration:500ms}.hover\:bg-\[var\(--wechat-green-dark\)\]:hover{background-color:var(--wechat-green-dark)}.hover\:bg-red-500\/30:hover{background-color:rgb(239 68 68 / 0.3)}.hover\:bg-white\/10:hover{background-color:rgb(255 255 255 / 0.1)}.hover\:bg-zinc-700\/70:hover{background-color:rgb(63 63 70 / 0.7)}.hover\:bg-zinc-800:hover{--tw-bg-opacity:1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-500\/30:hover{background-color:rgb(59 130 246 / 0.3)}.hover\:bg-zinc-700:hover{--tw-bg-opacity:1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}</style></head>

<body class="flex justify-center h-screen">

    <div class="w-full max-w-[var(--container-max-width)] flex flex-col relative bg-black shadow-2xl border-x border-zinc-900">

        <main id="view-chat" class="view-section hidden-view">
            <!-- 精简的监控状态栏 -->
            <div id="chat-status-island" class="glass-card px-4 py-2.5 mb-4 border border-white/10 rounded-xl flex items-center justify-between">
                <div class="flex items-center gap-2.5">
                    <div class="relative">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-[var(--wechat-green)] via-[var(--wechat-green-light)] to-[var(--wechat-green-dark)] flex items-center justify-center relative overflow-hidden ai-avatar">
                            <div class="absolute inset-0 ai-scanline"></div>
                            <div class="absolute inset-0 ai-particles"></div>
                            <svg class="w-4 h-4 text-white relative z-10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 1 1 7.072 0l-.548.547A3.374 3.374 0 0 1 14 18.469V19a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547a5 5 0 0 1 0-7.072l.548-.547A3.374 3.374 0 0 1 6 5.53V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v.531c0 .895.356 1.754.988 2.386l.548.547a5 5 0 0 1 0 7.072l-.548.547A3.374 3.374 0 0 1 14 18.469V19a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            <div class="absolute inset-0 rounded-full ai-glow"></div>
                        </div>
                        <div class="absolute -top-0.5 -right-0.5 w-2.5 h-2.5 bg-[var(--wechat-green)] rounded-full border-2 border-black animate-pulse ai-status-dot">
                            <div class="absolute inset-0 rounded-full bg-[var(--wechat-green)] animate-ping opacity-75"></div>
                        </div>
                    </div>
                    <div>
                        <p class="text-[11px] font-semibold text-white leading-tight" id="ai-status-text" style="opacity: 1;">正在检查合规性...</p>
                        <p class="text-[9px] text-zinc-500 leading-tight" id="ai-status-subtext" style="opacity: 1;">规则匹配中</p>
                    </div>
                </div>
                <div class="flex items-center gap-3 text-[10px]">
                    <div class="text-center">
                        <p class="text-zinc-500">待办</p>
                        <p class="text-xs font-bold text-[var(--wechat-green)]"><span id="stat-pending">3</span></p>
                    </div>
                    <div class="text-center">
                        <p class="text-zinc-500">已处理</p>
                        <p class="text-xs font-bold text-[var(--wechat-green)]"><span id="stat-processed">0</span></p>
                    </div>
                </div>
            </div>

            <div class="mb-8 flex items-center space-x-3">
                <div class="w-2 h-2 rounded-full bg-[var(--accent-blue)] animate-pulse"></div>
                <span class="text-xs font-bold tracking-widest text-zinc-400">待办决策 · <span id="task-count">3</span></span>
            </div>

            <div class="space-y-6" id="chat-container">
                <div class="flex space-x-3 task-item transition-all duration-500 chat-bubble" id="task-1">
                    <img src="./并保存_files/me.png" class="avatar-box chat-avatar" alt="助手">
                    <div class="flex-1 glass-card p-5 chat-message-card">
                        <div class="flex justify-between mb-3 text-[10px] font-bold uppercase tracking-tight">
                            <span class="text-[var(--wechat-green)]">字节跳动 VP</span>
                            <span class="text-zinc-600">刚才</span>
                        </div>
                        <p class="text-[14px] text-zinc-200 mb-5 leading-relaxed">关于<span class="text-[var(--wechat-green)] font-bold">排他协议</span>，如果无法缩短至 3 个月，我们可能无法推进 Q1 预算。</p>
                        <div class="bg-white/5 border border-white/5 p-4 rounded-xl mb-5 text-sm italic text-zinc-300 leading-relaxed">拟稿："时长可议，但需置换 S 级资源。"</div>
                        <div class="flex gap-2">
                            <button id="send-task-1" data-task-id="task-1" class="flex-1 btn-primary h-11 rounded-xl text-xs font-bold text-white cursor-pointer" style="pointer-events: auto; z-index: 10; position: relative;">确认发送</button>
                            <button id="edit-task-1" data-task-id="task-1" class="px-5 btn-ghost text-zinc-300 h-11 rounded-xl text-xs font-bold" style="pointer-events: auto; z-index: 10; position: relative;">修改</button>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-3 task-item transition-all duration-500 chat-bubble" id="task-2">
                    <img src="./并保存_files/me.png" class="avatar-box chat-avatar" alt="助手">
                    <div class="flex-1 glass-card p-5 border-l-2 border-zinc-700/50 chat-message-card">
                        <div class="flex justify-between mb-3 text-[10px] font-bold">
                            <span class="text-zinc-400">研发总监 老陈</span>
                            <span class="text-zinc-600">10分钟前</span>
                        </div>
                        <p class="text-[14px] text-zinc-200 mb-5 leading-relaxed">IDC 节点出现瞬间波动，已自动执行 <span class="text-zinc-400 underline">备用链路切换</span>，目前服务稳定。</p>
                        <button class="w-full btn-secondary text-white h-11 rounded-xl text-xs font-bold">确认并知晓</button>
                    </div>
                </div>

                <div class="flex space-x-3 task-item transition-all duration-500 chat-bubble" id="task-3">
                    <img src="./并保存_files/me.png" class="avatar-box chat-avatar" alt="助手">
                    <div class="flex-1 glass-card p-5 chat-message-card">
                        <div class="flex justify-between mb-3 text-[10px] font-bold">
                            <span class="text-zinc-400">财务审核部</span>
                            <span class="text-zinc-600">1小时前</span>
                        </div>
                        <p class="text-[14px] text-zinc-200 mb-5 leading-relaxed">Q1 季度预算报表已生成，核心支出增长 <span class="text-red-500">12%</span>，是否现在调阅详细项？</p>
                        <div class="flex gap-2">
                            <button class="flex-1 btn-secondary text-white h-11 rounded-xl text-xs font-bold">查阅明细</button>
                            <button class="px-5 btn-ghost text-zinc-300 h-11 rounded-xl text-xs font-bold">忽略</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="chat-empty" class="hidden text-center py-32">
                <div class="inline-flex flex-col items-center space-y-4">
                    <div class="w-16 h-16 rounded-full bg-zinc-900/50 flex items-center justify-center mb-2">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-500">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                    </div>
                    <p class="text-zinc-500 text-sm font-medium tracking-wider">所有决策已处理完毕</p>
                    <p class="text-zinc-700 text-xs italic">一切就绪，等待新的任务</p>
                </div>
            </div>

            <!-- 微信风格回复框（点击修改时弹出） -->
            <div id="wechat-reply-box" class="hidden fixed bottom-0 left-0 right-0 z-[200] bg-zinc-900/98 backdrop-blur-lg border-t border-white/5">
                <div class="max-w-[var(--container-max-width)] mx-auto px-3 py-2.5">
                    <!-- 输入区域 - 微信风格 -->
                    <div class="flex items-center gap-2">
                        <!-- 语音按钮 - 左侧圆形按钮 -->
                        <button id="wechat-voice-btn" class="w-10 h-10 flex-shrink-0 rounded-full bg-white/5 border-2 border-black flex items-center justify-center hover:bg-white/10 transition-all">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-[var(--wechat-green)]">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v1a7 7 0 0 1-14 0v-1M12 18v4m-4 0h8"></path>
                            </svg>
                        </button>

                        <!-- 文本输入框 - 白色背景，圆角 -->
                        <div class="flex-1 relative bg-white rounded-lg min-h-[40px] max-h-[120px] overflow-hidden flex items-center">
                            <textarea id="wechat-text-input" placeholder="输入回复内容..." class="w-full px-3 py-2 bg-transparent text-sm text-black placeholder-zinc-400 resize-none outline-none pr-10" rows="1"></textarea>
                            <!-- 输入框内的麦克风图标（当没有输入时显示） -->
                            <div id="wechat-input-mic" class="absolute right-2 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center pointer-events-none" style="display: flex;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                    <path d="M19 10v1a7 7 0 0 1-14 0v-1M12 18v4m-4 0h8"></path>
                                </svg>
                            </div>
                        </div>

                        <!-- 文件/附件按钮 - 右侧圆形按钮 -->
                        <button id="wechat-file-btn" class="w-10 h-10 flex-shrink-0 rounded-full bg-white/5 border-2 border-black flex items-center justify-center hover:bg-white/10 transition-all">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>

                        <!-- 发送按钮 - 只在有输入时显示 -->
                        <button id="wechat-send-btn" class="hidden w-10 h-10 flex-shrink-0 rounded-full bg-[var(--wechat-green)] flex items-center justify-center hover:bg-[var(--wechat-green-dark)] transition-all">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>

                    <!-- 语音输入状态显示（录音时显示在输入框上方） -->
                    <div id="wechat-voice-status" class="hidden mt-2 mb-2">
                        <div class="flex items-center justify-between px-2 py-1.5 bg-red-500/10 rounded-lg border border-red-500/30">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                                <span class="text-xs text-red-400 font-medium" id="wechat-voice-status-text">正在录音...</span>
                            </div>
                            <div class="flex gap-2">
                                <button id="wechat-voice-stop-btn" class="text-xs px-3 py-1 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-all">停止</button>
                                <button id="wechat-voice-cancel-btn" class="text-xs px-3 py-1 bg-zinc-700/50 text-zinc-400 rounded-lg hover:bg-zinc-700/70 transition-all">取消</button>
                            </div>
                        </div>
                        <div id="wechat-voice-waveform" class="mt-2 flex items-center justify-center gap-1 h-6">
                            <!-- 波形动画将通过JS动态生成 -->
                        </div>
                    </div>

                    <!-- 文件上传进度（上传时显示在输入框上方） -->
                    <div id="wechat-file-progress" class="hidden mt-2 mb-2">
                        <div class="px-2 py-1.5 bg-[var(--wechat-green)]/10 rounded-lg border border-[var(--wechat-green)]/30">
                            <div class="h-1 bg-white/10 rounded-full overflow-hidden mb-1">
                                <div id="wechat-file-progress-bar" class="h-full bg-[var(--wechat-green)] transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p id="wechat-file-status" class="text-[10px] text-zinc-400"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 隐藏的文件输入 -->
            <input type="file" id="wechat-file-input" multiple="" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif" class="hidden">
        </main>

        <section id="view-assets" class="view-section hidden-view">
            <div class="mb-6 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-2 rounded-full bg-[var(--accent-blue)]"></div>
                    <h2 class="text-xl font-bold tracking-tight">知识资产</h2>
                </div>
                <div class="flex flex-col items-end">
                    <button onclick="assetActions.upload()" class="upload-btn glass-card px-4 py-2 flex items-center space-x-2 border border-white/10 hover:border-[var(--wechat-green)]/50 transition-all">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-300">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <span class="text-xs font-semibold text-zinc-300">上传</span>
                    </button>
                    <p class="text-[9px] text-zinc-600 mt-1.5">支持 Word、Excel、PDF 文件</p>
                </div>
            </div>
            <div class="space-y-4" id="assets-list">
                        <div class="glass-card asset-card p-5 border-l-4 border-[var(--wechat-green)]" data-index="0">
                            <div class="asset-header">
                                <div class="flex-1">
                                    <p class="asset-title">2026战略合作排他准则.pdf</p>
                                    <div class="ai-extract-result">AI 提取结果：提取了排他协议核心规则：12个月期限上限、对等接口权限要求、违约金需覆盖3年收益。已应用于战略合作决策流程。</div>
                                </div>
                                
                                <button class="asset-expand-btn ml-2" onclick="assetActions.toggleExpand(0)">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="asset-details" id="asset-details-0">
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="8" x2="12" y2="12"></line>
                                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                        </svg>
                                        核心摘要
                                    </div>
                                    <div class="asset-section-content">规定了战略合作伙伴关系的排他性条款，核心约束包括：合作期限上限12个月，双方享有对等接口权限，违约金需覆盖3年预期收益。适用于S级战略资源置换场景。</div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                        </svg>
                                        关键词提取
                                    </div>
                                    <div class="asset-keywords">
                                        <span class="asset-keyword">排他协议</span><span class="asset-keyword">12个月上限</span><span class="asset-keyword">对等接口权限</span><span class="asset-keyword">违约金</span><span class="asset-keyword">S级资源</span><span class="asset-keyword">战略合作</span>
                                    </div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        分身逻辑转化
                                    </div>
                                    <div class="asset-section-content">当收到涉及排他协议的决策请求时，优先检查期限是否超过12个月。若超过，需评估是否匹配S级资源置换。回复时强调对等权限和违约金覆盖3年收益的要求。</div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card asset-card p-5 border-l-2 border-zinc-700/30" data-index="1">
                            <div class="asset-header">
                                <div class="flex-1">
                                    <p class="asset-title">CEO 个人沟通偏好模型.json</p>
                                    <div class="ai-extract-result">AI 提取结果：提取了紧急处理流程：结论先行、数据驱动、避免不确定词汇。已应用于所有CEO沟通场景。</div>
                                </div>
                                <span class="asset-badge">已习得</span>
                                <button class="asset-expand-btn ml-2" onclick="assetActions.toggleExpand(1)">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="asset-details" id="asset-details-1">
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="8" x2="12" y2="12"></line>
                                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                        </svg>
                                        核心摘要
                                    </div>
                                    <div class="asset-section-content">基于历史沟通数据训练的CEO沟通风格模型。偏好简洁直接、数据驱动、结果导向的表达方式。避免冗长铺垫，重视时间效率。</div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                        </svg>
                                        关键词提取
                                    </div>
                                    <div class="asset-keywords">
                                        <span class="asset-keyword">沟通风格</span><span class="asset-keyword">简洁直接</span><span class="asset-keyword">数据驱动</span><span class="asset-keyword">结果导向</span><span class="asset-keyword">时间效率</span>
                                    </div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        分身逻辑转化
                                    </div>
                                    <div class="asset-section-content">所有发送给CEO的决策建议和报告，需遵循"结论先行"原则。首句即核心观点，后续用数据支撑。避免使用"可能"、"或许"等不确定词汇。</div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card asset-card p-5 border-l-2 border-zinc-700/30" data-index="2">
                            <div class="asset-header">
                                <div class="flex-1">
                                    <p class="asset-title">核心管理层期权回购协议.pdf</p>
                                    <div class="ai-extract-result">AI 提取结果：提取了期权回购标准流程：行权条件检查、估值计算方法、自动生成回购时间表。已应用于期权管理决策。</div>
                                </div>
                                <span class="asset-badge">V2.1</span>
                                <button class="asset-expand-btn ml-2" onclick="assetActions.toggleExpand(2)">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="asset-details" id="asset-details-2">
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="8" x2="12" y2="12"></line>
                                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                        </svg>
                                        核心摘要
                                    </div>
                                    <div class="asset-section-content">定义了核心管理层期权回购的标准流程和定价机制。包含行权条件、回购触发条件、估值方法（基于最近一轮融资估值）和支付时间表。</div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                        </svg>
                                        关键词提取
                                    </div>
                                    <div class="asset-keywords">
                                        <span class="asset-keyword">期权回购</span><span class="asset-keyword">行权条件</span><span class="asset-keyword">估值方法</span><span class="asset-keyword">融资估值</span><span class="asset-keyword">支付时间表</span>
                                    </div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        分身逻辑转化
                                    </div>
                                    <div class="asset-section-content">涉及期权回购的审批流程，自动检查是否符合行权条件。估值计算需引用最近一轮融资的估值数据。若触发回购条件，自动生成回购时间表和资金需求预测。</div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card asset-card p-5 border-l-2 border-zinc-700/30" data-index="3">
                            <div class="asset-header">
                                <div class="flex-1">
                                    <p class="asset-title">研发部 2026 成本红线指标.xlsx</p>
                                    <div class="ai-extract-result">AI 提取结果：提取了成本红线检查机制：自动对比预算上限、风险等级标注、CEO审批触发条件。已应用于研发支出审批。</div>
                                </div>
                                
                                <button class="asset-expand-btn ml-2" onclick="assetActions.toggleExpand(3)">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="asset-details" id="asset-details-3">
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="8" x2="12" y2="12"></line>
                                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                        </svg>
                                        核心摘要
                                    </div>
                                    <div class="asset-section-content">定义了研发部门2026年各项成本的红线指标。包括人力成本、基础设施、云服务、第三方工具等分类预算上限。超出红线需CEO审批。</div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                        </svg>
                                        关键词提取
                                    </div>
                                    <div class="asset-keywords">
                                        <span class="asset-keyword">成本红线</span><span class="asset-keyword">人力成本</span><span class="asset-keyword">基础设施</span><span class="asset-keyword">云服务</span><span class="asset-keyword">预算上限</span><span class="asset-keyword">CEO审批</span>
                                    </div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        分身逻辑转化
                                    </div>
                                    <div class="asset-section-content">所有研发相关的支出申请，自动对比成本红线。若接近或超出红线，在决策建议中标注风险等级，并提示需要CEO审批。定期生成成本趋势分析。</div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card asset-card p-5 border-l-2 border-zinc-700/30" data-index="4">
                            <div class="asset-header">
                                <div class="flex-1">
                                    <p class="asset-title">友商竞品架构异动情报集.txt</p>
                                    <div class="ai-extract-result">AI 提取结果：提取了竞品分析框架：技术栈对比、架构优劣评估、竞争视角决策支持。已应用于技术选型决策。</div>
                                </div>
                                
                                <button class="asset-expand-btn ml-2" onclick="assetActions.toggleExpand(4)">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="asset-details" id="asset-details-4">
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="8" x2="12" y2="12"></line>
                                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                        </svg>
                                        核心摘要
                                    </div>
                                    <div class="asset-section-content">持续更新的竞品技术架构变化情报。包含技术栈迁移、基础设施调整、新功能架构设计等信息。用于技术决策参考和竞争分析。</div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                        </svg>
                                        关键词提取
                                    </div>
                                    <div class="asset-keywords">
                                        <span class="asset-keyword">竞品分析</span><span class="asset-keyword">技术架构</span><span class="asset-keyword">技术栈</span><span class="asset-keyword">基础设施</span><span class="asset-keyword">竞争情报</span>
                                    </div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        分身逻辑转化
                                    </div>
                                    <div class="asset-section-content">当涉及技术选型或架构决策时，自动检索相关竞品情报。在决策建议中对比我方方案与竞品方案的优劣，提供竞争视角的分析。</div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card asset-card p-5 border-l-2 border-zinc-700/30" data-index="5">
                            <div class="asset-header">
                                <div class="flex-1">
                                    <p class="asset-title">Q1 融资防御补充条款.doc</p>
                                    <div class="ai-extract-result">AI 提取结果：提取了融资防御检查规则：反稀释条款、一票否决权、法务审核触发条件。已应用于重大决策审核。</div>
                                </div>
                                
                                <button class="asset-expand-btn ml-2" onclick="assetActions.toggleExpand(5)">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="asset-details" id="asset-details-5">
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="8" x2="12" y2="12"></line>
                                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                        </svg>
                                        核心摘要
                                    </div>
                                    <div class="asset-section-content">Q1季度融资防御策略的补充条款。包含反稀释条款、优先认购权、董事会席位安排、关键决策一票否决权等保护性条款。</div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                        </svg>
                                        关键词提取
                                    </div>
                                    <div class="asset-keywords">
                                        <span class="asset-keyword">融资防御</span><span class="asset-keyword">反稀释</span><span class="asset-keyword">优先认购权</span><span class="asset-keyword">董事会席位</span><span class="asset-keyword">一票否决权</span>
                                    </div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        分身逻辑转化
                                    </div>
                                    <div class="asset-section-content">涉及融资、股权变更、重大决策时，自动检查是否符合防御条款。若存在冲突，在决策建议中明确标注风险，并建议法务部门审核。</div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card asset-card p-5 border-l-2 border-zinc-700/30" data-index="6">
                            <div class="asset-header">
                                <div class="flex-1">
                                    <p class="asset-title">跨境数据流通准则 2026版.pdf</p>
                                    <div class="ai-extract-result">AI 提取结果：提取了数据合规检查流程：数据分类标准、出境审批流程、合规风险标记机制。已应用于跨境数据传输决策。</div>
                                </div>
                                
                                <button class="asset-expand-btn ml-2" onclick="assetActions.toggleExpand(6)">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="asset-details" id="asset-details-6">
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="8" x2="12" y2="12"></line>
                                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                        </svg>
                                        核心摘要
                                    </div>
                                    <div class="asset-section-content">2026年最新版跨境数据流通合规准则。明确了数据分类标准、出境审批流程、数据加密要求、存储位置限制等合规要求。</div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                        </svg>
                                        关键词提取
                                    </div>
                                    <div class="asset-keywords">
                                        <span class="asset-keyword">跨境数据</span><span class="asset-keyword">数据合规</span><span class="asset-keyword">数据分类</span><span class="asset-keyword">出境审批</span><span class="asset-keyword">数据加密</span><span class="asset-keyword">存储限制</span>
                                    </div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        分身逻辑转化
                                    </div>
                                    <div class="asset-section-content">涉及数据出境、跨境传输的决策，自动检查是否符合合规准则。根据数据分类（敏感/一般）提供相应的审批流程建议。若存在合规风险，标记为高优先级。</div>
                                </div>
                            </div>
                        </div>
                    </div>
        </section>

        <section id="view-wechat" class="view-section hidden-view">
            <div class="mb-6 flex items-center space-x-3">
                <div class="w-2 h-2 rounded-full bg-[var(--accent-blue)]"></div>
                <h2 class="text-xl font-bold tracking-tight">微信影子跟踪</h2>
            </div>

            <!-- 头部统计信息 -->
            <div class="glass-card p-5 mb-6 border-l-4 border-[var(--wechat-green)]">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <p class="text-xs text-zinc-400 mb-1">今日已吸收</p>
                        <p class="text-2xl font-bold text-white"><span id="wechat-total-count">0</span> 条信息</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-zinc-400 mb-1">决策点</p>
                        <p class="text-xl font-bold text-[var(--wechat-green)]"><span id="wechat-decision-count">0</span></p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-zinc-400 mb-1">噪音过滤</p>
                        <p class="text-xl font-bold text-zinc-500"><span id="wechat-noise-count">0</span></p>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-[10px] text-zinc-500">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>Mac Mini 定时巡检中 · 每 30 秒更新</span>
                </div>
            </div>

            <!-- 消息列表 -->
            <div class="space-y-3" id="wechat-messages">
                <!-- 消息将通过 JavaScript 动态生成 -->
            </div>
        </section>

        <section id="view-tasks" class="view-section active-view">
            <div class="mb-6 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-2 rounded-full bg-[var(--wechat-green)]"></div>
                    <h2 class="text-xl font-bold tracking-tight">任务与日程</h2>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="app.switchView(&#39;log&#39;)" class="glass-card px-3 py-2 flex items-center space-x-1.5 border border-white/10 hover:border-[var(--wechat-green)]/50 transition-all">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-300">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        <span class="text-xs font-semibold text-zinc-300">日志</span>
                    </button>
                    <button onclick="taskActions.showAddTask()" class="glass-card px-4 py-2 flex items-center space-x-2 border border-white/10 hover:border-[var(--wechat-green)]/50 transition-all">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-300">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        <span class="text-xs font-semibold text-zinc-300">新建</span>
                    </button>
                </div>
            </div>

            <!-- 统计卡片 -->
            <div class="grid grid-cols-3 gap-3 mb-6">
                <div class="glass-card p-4 border-l-2 border-yellow-500">
                    <p class="text-[10px] text-zinc-500 mb-1">待处理</p>
                    <p class="text-xl font-bold text-yellow-500"><span id="task-pending-count">7</span></p>
                </div>
                <div class="glass-card p-4 border-l-2 border-blue-500">
                    <p class="text-[10px] text-zinc-500 mb-1">进行中</p>
                    <p class="text-xl font-bold text-blue-500"><span id="task-progress-count">3</span></p>
                </div>
                <div class="glass-card p-4 border-l-2 border-[var(--wechat-green)]">
                    <p class="text-[10px] text-zinc-500 mb-1">已完成</p>
                    <p class="text-xl font-bold text-[var(--wechat-green)]"><span id="task-completed-count">2</span></p>
                </div>
            </div>

            <!-- 标签筛选 -->
            <div class="flex space-x-2 mb-6 overflow-x-auto scrollbar-hide pb-2">
                <button onclick="taskActions.filterTasks(&#39;pending&#39;)" class="task-filter-btn px-4 py-2 rounded-xl text-xs font-semibold active" data-filter="pending">待处理</button>
                <button onclick="taskActions.filterTasks(&#39;progress&#39;)" class="task-filter-btn px-4 py-2 rounded-xl text-xs font-semibold" data-filter="progress">进行中</button>
                <button onclick="taskActions.filterTasks(&#39;completed&#39;)" class="task-filter-btn px-4 py-2 rounded-xl text-xs font-semibold" data-filter="completed">已完成</button>
                <button onclick="taskActions.filterTasks(&#39;urgent&#39;)" class="task-filter-btn px-4 py-2 rounded-xl text-xs font-semibold" data-filter="urgent">紧急</button>
                <button onclick="taskActions.filterTasks(&#39;all&#39;)" class="task-filter-btn px-4 py-2 rounded-xl text-xs font-semibold" data-filter="all">全部</button>
            </div>

            <!-- 任务列表 -->
            <div class="space-y-3" id="tasks-list">
                        <div class="glass-card task-card p-4 border-l-2 border-zinc-700/30" data-task-id="1">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="text-sm font-bold text-zinc-200 ">撰写并发送报告</h3>
                                        <span class="task-status-badge task-status-pending">待处理</span>
                                        
                                        
                                    </div>
                                    <p class="text-xs text-zinc-400 mb-2 leading-relaxed">从微信对话中提取：明天下午3点前把报告发我</p>
                                    <div class="flex items-center gap-3 text-[10px] text-zinc-500">
                                        <span>来源：微信对话</span>
                                        <span>·</span>
                                        <span>字节跳动 VP</span>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/5">
                                <div class="task-due-time ">
                                    📅 今天 15:00
                                </div>
                                <div class="flex gap-2">
                                    
                                        
                                            <button onclick="taskActions.updateTaskStatus(1, &#39;progress&#39;)" class="px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded-lg text-xs font-semibold hover:bg-blue-500/30">开始</button>
                                        
                                        
                                        <button onclick="taskActions.importToCalendar(1)" class="px-3 py-1.5 bg-zinc-800 text-zinc-400 rounded-lg text-xs font-semibold hover:bg-zinc-700">导入日历</button>
                                    
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card task-card p-4 task-urgent" data-task-id="3">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="text-sm font-bold text-zinc-200 ">审核Q1预算报表</h3>
                                        <span class="task-status-badge task-status-pending">待处理</span>
                                        <span class="task-status-badge" style="background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3);">紧急</span>
                                        
                                    </div>
                                    <p class="text-xs text-zinc-400 mb-2 leading-relaxed">财务审核部：Q1季度预算报表已生成，核心支出增长12%</p>
                                    <div class="flex items-center gap-3 text-[10px] text-zinc-500">
                                        <span>来源：微信消息</span>
                                        <span>·</span>
                                        <span>财务审核部</span>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/5">
                                <div class="task-due-time urgent">
                                    📅 今天 18:00
                                </div>
                                <div class="flex gap-2">
                                    
                                        
                                            <button onclick="taskActions.updateTaskStatus(3, &#39;progress&#39;)" class="px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded-lg text-xs font-semibold hover:bg-blue-500/30">开始</button>
                                        
                                        
                                        <button onclick="taskActions.importToCalendar(3)" class="px-3 py-1.5 bg-zinc-800 text-zinc-400 rounded-lg text-xs font-semibold hover:bg-zinc-700">导入日历</button>
                                    
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card task-card p-4 border-l-2 border-zinc-700/30" data-task-id="5">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="text-sm font-bold text-zinc-200 ">准备下周产品发布会材料</h3>
                                        <span class="task-status-badge task-status-pending">待处理</span>
                                        
                                        
                                    </div>
                                    <p class="text-xs text-zinc-400 mb-2 leading-relaxed">从邮件中提取：下周一上午10点需要产品发布会的所有材料</p>
                                    <div class="flex items-center gap-3 text-[10px] text-zinc-500">
                                        <span>来源：邮件</span>
                                        <span>·</span>
                                        <span>市场总监</span>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/5">
                                <div class="task-due-time ">
                                    📅 6天后 10:00
                                </div>
                                <div class="flex gap-2">
                                    
                                        
                                            <button onclick="taskActions.updateTaskStatus(5, &#39;progress&#39;)" class="px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded-lg text-xs font-semibold hover:bg-blue-500/30">开始</button>
                                        
                                        
                                        <button onclick="taskActions.importToCalendar(5)" class="px-3 py-1.5 bg-zinc-800 text-zinc-400 rounded-lg text-xs font-semibold hover:bg-zinc-700">导入日历</button>
                                    
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card task-card p-4 task-urgent" data-task-id="7">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="text-sm font-bold text-zinc-200 ">回复法务部合同审核意见</h3>
                                        <span class="task-status-badge task-status-pending">待处理</span>
                                        <span class="task-status-badge" style="background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3);">紧急</span>
                                        
                                    </div>
                                    <p class="text-xs text-zinc-400 mb-2 leading-relaxed">法务部：关于期权回购协议的争议条款，需要您确认是否接受对方提出的修改建议</p>
                                    <div class="flex items-center gap-3 text-[10px] text-zinc-500">
                                        <span>来源：微信消息</span>
                                        <span>·</span>
                                        <span>法务部</span>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/5">
                                <div class="task-due-time urgent">
                                    ⏰ 已逾期
                                </div>
                                <div class="flex gap-2">
                                    
                                        
                                            <button onclick="taskActions.updateTaskStatus(7, &#39;progress&#39;)" class="px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded-lg text-xs font-semibold hover:bg-blue-500/30">开始</button>
                                        
                                        
                                        <button onclick="taskActions.importToCalendar(7)" class="px-3 py-1.5 bg-zinc-800 text-zinc-400 rounded-lg text-xs font-semibold hover:bg-zinc-700">导入日历</button>
                                    
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card task-card p-4 border-l-2 border-zinc-700/30" data-task-id="8">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="text-sm font-bold text-zinc-200 ">审批核心管理层期权回购申请</h3>
                                        <span class="task-status-badge task-status-pending">待处理</span>
                                        
                                        
                                    </div>
                                    <p class="text-xs text-zinc-400 mb-2 leading-relaxed">人事部：核心管理层期权回购申请已提交，请审批</p>
                                    <div class="flex items-center gap-3 text-[10px] text-zinc-500">
                                        <span>来源：微信消息</span>
                                        <span>·</span>
                                        <span>人事部</span>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/5">
                                <div class="task-due-time ">
                                    📅 今天 09:00
                                </div>
                                <div class="flex gap-2">
                                    
                                        
                                            <button onclick="taskActions.updateTaskStatus(8, &#39;progress&#39;)" class="px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded-lg text-xs font-semibold hover:bg-blue-500/30">开始</button>
                                        
                                        
                                        <button onclick="taskActions.importToCalendar(8)" class="px-3 py-1.5 bg-zinc-800 text-zinc-400 rounded-lg text-xs font-semibold hover:bg-zinc-700">导入日历</button>
                                    
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card task-card p-4 border-l-2 border-zinc-700/30" data-task-id="9">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="text-sm font-bold text-zinc-200 ">确认技术架构调整方案</h3>
                                        <span class="task-status-badge task-status-pending">待处理</span>
                                        
                                        
                                    </div>
                                    <p class="text-xs text-zinc-400 mb-2 leading-relaxed">CTO：技术架构调整方案已准备，涉及成本增加约15%，需要您决策</p>
                                    <div class="flex items-center gap-3 text-[10px] text-zinc-500">
                                        <span>来源：微信对话</span>
                                        <span>·</span>
                                        <span>CTO</span>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/5">
                                <div class="task-due-time ">
                                    📅 4天后
                                </div>
                                <div class="flex gap-2">
                                    
                                        
                                            <button onclick="taskActions.updateTaskStatus(9, &#39;progress&#39;)" class="px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded-lg text-xs font-semibold hover:bg-blue-500/30">开始</button>
                                        
                                        
                                        <button onclick="taskActions.importToCalendar(9)" class="px-3 py-1.5 bg-zinc-800 text-zinc-400 rounded-lg text-xs font-semibold hover:bg-zinc-700">导入日历</button>
                                    
                                </div>
                            </div>
                        </div>
                    
                        <div class="glass-card task-card p-4 border-l-2 border-zinc-700/30" data-task-id="11">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="text-sm font-bold text-zinc-200 ">完成Q1季度总结报告</h3>
                                        <span class="task-status-badge task-status-pending">待处理</span>
                                        
                                        
                                    </div>
                                    <p class="text-xs text-zinc-400 mb-2 leading-relaxed">从会议中提取：月底前需要完成Q1季度业务总结报告</p>
                                    <div class="flex items-center gap-3 text-[10px] text-zinc-500">
                                        <span>来源：会议录音</span>
                                        <span>·</span>
                                        <span>CEO</span>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/5">
                                <div class="task-due-time ">
                                    📅 2月13日 18:00
                                </div>
                                <div class="flex gap-2">
                                    
                                        
                                            <button onclick="taskActions.updateTaskStatus(11, &#39;progress&#39;)" class="px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded-lg text-xs font-semibold hover:bg-blue-500/30">开始</button>
                                        
                                        
                                        <button onclick="taskActions.importToCalendar(11)" class="px-3 py-1.5 bg-zinc-800 text-zinc-400 rounded-lg text-xs font-semibold hover:bg-zinc-700">导入日历</button>
                                    
                                </div>
                            </div>
                        </div>
                    </div>

            <!-- 空状态 -->
            <div id="tasks-empty" class="hidden text-center py-16">
                <div class="inline-flex flex-col items-center space-y-3">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-700">
                        <path d="M9 11l3 3L22 4"></path>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                    </svg>
                    <p class="text-zinc-600 text-sm">暂无任务</p>
                </div>
            </div>
        </section>

        <section id="view-log" class="view-section hidden-view">
            <div class="mb-6 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <button onclick="app.switchView(&#39;tasks&#39;)" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-zinc-800 transition-colors mr-1">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <div class="w-2 h-2 rounded-full bg-[var(--wechat-green)]"></div>
                    <h2 class="text-xl font-bold tracking-tight">活动日志</h2>
                </div>
            </div>

            <!-- AI状态卡片合并到日志页面 -->
            <div id="log-status-island" class="glass-card p-4 mb-6 border border-white/10 rounded-2xl">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <div class="relative ai-avatar-container">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[var(--wechat-green)] via-[var(--wechat-green-light)] to-[var(--wechat-green-dark)] flex items-center justify-center relative overflow-hidden ai-avatar">
                                <!-- 数字化扫描线效果 -->
                                <div class="absolute inset-0 ai-scanline"></div>
                                <!-- 粒子效果背景 -->
                                <div class="absolute inset-0 ai-particles"></div>
                                <!-- AI图标 -->
                                <svg class="w-6 h-6 text-white relative z-10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 1 1 7.072 0l-.548.547A3.374 3.374 0 0 1 14 18.469V19a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547a5 5 0 0 1 0-7.072l.548-.547A3.374 3.374 0 0 1 6 5.53V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v.531c0 .895.356 1.754.988 2.386l.548.547a5 5 0 0 1 0 7.072l-.548.547A3.374 3.374 0 0 1 14 18.469V19a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                </svg>
                                <!-- 外圈光晕 -->
                                <div class="absolute inset-0 rounded-full ai-glow"></div>
                            </div>
                            <div class="absolute -top-1 -right-1 w-3.5 h-3.5 bg-[var(--wechat-green)] rounded-full border-2 border-black animate-pulse ai-status-dot">
                                <div class="absolute inset-0 rounded-full bg-[var(--wechat-green)] animate-ping opacity-75"></div>
                            </div>
                        </div>
                        <div>
                            <p class="text-xs font-semibold text-white mb-0.5" id="log-ai-status-text" style="opacity: 1;">正在检查合规性...</p>
                            <p class="text-[10px] text-zinc-400" id="log-ai-status-subtext" style="opacity: 1;">规则匹配中</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-zinc-500 mb-1">今日处理</p>
                        <p class="text-lg font-bold text-white"><span id="log-today-processed">3</span></p>
                    </div>
                </div>

                <!-- 数据统计 -->
                <div class="grid grid-cols-4 gap-3 pt-3 border-t border-white/5">
                    <div class="text-center">
                        <p class="text-[10px] text-zinc-500 mb-1">待办</p>
                        <p class="text-sm font-bold text-[var(--wechat-green)]"><span id="log-stat-pending">3</span></p>
                    </div>
                    <div class="text-center">
                        <p class="text-[10px] text-zinc-500 mb-1">已处理</p>
                        <p class="text-sm font-bold text-[var(--wechat-green)]"><span id="log-stat-processed">0</span></p>
                    </div>
                    <div class="text-center">
                        <p class="text-[10px] text-zinc-500 mb-1">分析中</p>
                        <p class="text-sm font-bold text-yellow-500"><span id="log-stat-analyzing">0</span></p>
                    </div>
                    <div class="text-center">
                        <p class="text-[10px] text-zinc-500 mb-1">监控</p>
                        <p class="text-sm font-bold text-purple-500"><span id="log-stat-monitoring">24/7</span></p>
                    </div>
                </div>
            </div>
            <div class="flex space-x-3 overflow-x-auto mb-8 pb-2 scrollbar-hide">
                <div class="flex-shrink-0 px-5 py-3 date-chip active rounded-2xl text-xs font-black" data-date="2026-02-01" onclick="logActions.selectDate(&#39;2026-02-01&#39;, this)">2月1日</div>
                <div class="flex-shrink-0 px-5 py-3 date-chip bg-zinc-900/80 text-zinc-400 rounded-2xl text-xs" data-date="2026-01-31" onclick="logActions.selectDate(&#39;2026-01-31&#39;, this)">1月31日</div>
                <div class="flex-shrink-0 px-5 py-3 date-chip bg-zinc-900/80 text-zinc-400 rounded-2xl text-xs" data-date="2026-01-30" onclick="logActions.selectDate(&#39;2026-01-30&#39;, this)">1月30日</div>
                <button onclick="logActions.openCalendar()" class="w-11 h-11 btn-ghost rounded-2xl flex items-center justify-center">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"></rect><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                </button>
            </div>

            <div id="log-content" class="space-y-8 pl-4 border-l-2 border-zinc-800/50 ml-2 transition-opacity duration-300" style="opacity: 1;"><div class="text-[10px] text-zinc-700 uppercase font-black py-4 tracking-wider">2026年2月1日</div>
                            <div class="relative log-item ">
                                <div class="absolute -left-[25px] top-1 w-3 h-3 rounded-full bg-[var(--accent-blue)] log-dot border-2 border-black"></div>
                                <p class="text-[10px] text-zinc-500 mb-1 uppercase tracking-tighter font-semibold">15:30 / 决策发送</p>
                                <p class="text-[13px] text-zinc-300 italic font-medium leading-relaxed">向字节跳动发送了修订后的排他条款回复。</p>
                            </div>
                        
                            <div class="relative log-item ">
                                <div class="absolute -left-[25px] top-1 w-2.5 h-2.5 rounded-full bg-zinc-700 log-dot border-2 border-black"></div>
                                <p class="text-[10px] text-zinc-600 mb-1 uppercase tracking-tighter font-semibold">14:20 / 知识吸收</p>
                                <p class="text-[13px] text-zinc-400 italic font-medium leading-relaxed">解析《2026排他准则》，更新决策逻辑。</p>
                            </div>
                        
                            <div class="relative log-item ">
                                <div class="absolute -left-[25px] top-1 w-2.5 h-2.5 rounded-full bg-zinc-700 log-dot border-2 border-black"></div>
                                <p class="text-[10px] text-zinc-600 mb-1 uppercase tracking-tighter font-semibold">12:00 / 自动审批</p>
                                <p class="text-[13px] text-zinc-400 italic font-medium leading-relaxed">已自动打回老陈的超限差旅报销申请。</p>
                            </div>
                        
                            <div class="relative log-item ">
                                <div class="absolute -left-[25px] top-1 w-2.5 h-2.5 rounded-full bg-zinc-700 log-dot border-2 border-black"></div>
                                <p class="text-[10px] text-zinc-600 mb-1 uppercase tracking-tighter font-semibold">10:45 / 系统维护</p>
                                <p class="text-[13px] text-zinc-400 italic font-medium leading-relaxed">IDC 波动确认已解决，备用链路正常运行。</p>
                            </div>
                        
                            <div class="relative log-item opacity-50">
                                <div class="absolute -left-[25px] top-1 w-2.5 h-2.5 rounded-full bg-zinc-800 log-dot border-2 border-black"></div>
                                <p class="text-[10px] text-zinc-700 mb-1 uppercase tracking-tighter font-semibold">09:00 / 简报生成</p>
                                <p class="text-[13px] text-zinc-500 italic font-medium leading-relaxed">今日行业动态已汇总</p>
                            </div>
                        </div>
        </section>

        <!-- 日历弹窗 -->
        <div id="calendar-modal" class="hidden fixed inset-0 z-[200] flex items-center justify-center bg-black/80 backdrop-blur-sm" onclick="if(event.target === this) logActions.closeCalendar()">
            <div class="glass-card p-6 max-w-sm w-full mx-4 relative" onclick="event.stopPropagation()">
                <button onclick="logActions.closeCalendar()" class="absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-lg hover:bg-zinc-800 transition-colors">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
                <h3 id="calendar-month" class="text-lg font-bold mb-4 text-center">2026年2月</h3>
                <div id="calendar-grid"></div>
            </div>
        </div>

        <div class="nav-mask"></div>
        <footer class="absolute bottom-0 inset-x-0 h-[var(--nav-height)] flex justify-between items-center px-12 pb-8 z-[100]">
            <button onclick="app.switchView(&#39;assets&#39;)" id="nav-assets" class="nav-icon opacity-40"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg></button>
            <div class="flex justify-center -mt-10">
                <button id="main-action-btn" class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow-xl border-4 border-black transition-all" onclick="app.switchView(&#39;chat&#39;)" oncontextmenu="event.preventDefault(); app.switchView(&#39;wechat&#39;); return false;">
                    <svg id="icon-voice" class="main-icon w-6 h-6 transition-all duration-300 hidden" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.5">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v1a7 7 0 0 1-14 0v-1M12 18v4m-4 0h8"></path>
                    </svg>
                    <svg id="icon-message" class="main-icon w-6 h-6 transition-all duration-300" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.5">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                </button>
            </div>
            <button onclick="app.switchView(&#39;tasks&#39;)" id="nav-log" class="nav-icon active"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg></button>
        </footer>
    </div>

    <script>
        const app = {
            currentView: 'chat',
            switchView(target) {
                this.currentView = target;
                ['chat', 'assets', 'log', 'wechat', 'tasks'].forEach(v => {
                    const el = document.getElementById(`view-${v}`);
                    if (el) {
                        if (v === target) el.classList.replace('hidden-view', 'active-view');
                        else el.classList.replace('active-view', 'hidden-view');
                    }
                });

                // 更新主按钮图标
                const iconVoice = document.getElementById('icon-voice');
                const iconMessage = document.getElementById('icon-message');

                if (target === 'chat') {
                    // 切换到聊天视图，显示麦克风图标
                    if (iconVoice) iconVoice.classList.remove('hidden');
                    if (iconMessage) iconMessage.classList.add('hidden');
                    // 启动AI状态系统
                    aiStatusSystem.start();
                    // 更新统计数据
                    chatActions.updateStats();
                } else {
                    // 切换到其他视图，显示信息图标
                    if (iconVoice) iconVoice.classList.add('hidden');
                    if (iconMessage) iconMessage.classList.remove('hidden');
                    // 停止AI状态系统
                    aiStatusSystem.stop();
                }

                // 更新导航图标状态
                const navAssets = document.getElementById('nav-assets');
                const navLog = document.getElementById('nav-log');
                const mainBtn = document.getElementById('main-action-btn');

                // 重置所有导航图标
                [navAssets, navLog].forEach(nav => {
                    if (nav) {
                        nav.classList.remove('active');
                        nav.classList.add('opacity-40');
                    }
                });

                // 激活当前视图的导航图标
                if (target === 'assets') {
                    if (navAssets) {
                        navAssets.classList.add('active');
                        navAssets.classList.remove('opacity-40');
                    }
                    // 确保知识资产列表已渲染
                    if (document.getElementById('assets-list') && !document.getElementById('assets-list').innerHTML.trim()) {
                        assetActions.renderAssets();
                    }
                } else if (target === 'tasks') {
                    if (navLog) {
                        navLog.classList.add('active');
                        navLog.classList.remove('opacity-40');
                    }
                    // 初始化任务视图
                    taskActions.renderTasks();
                    taskActions.updateStats();
                } else if (target === 'log') {
                    // 活动日志视图（从任务页面进入）
                    // 启动AI状态系统（日志页面也需要）
                    aiStatusSystem.start();
                    // 更新统计数据
                    chatActions.updateStats();
                } else if (target === 'wechat') {
                    // 启动微信监控
                    wechatTracking.startMonitoring();
                } else {
                    // 停止微信监控（切换到其他视图时）
                    wechatTracking.stopMonitoring();
                }
            }
        };

        const chatActions = {
            tasks: 3,
            processed: 0,
            analyzing: 0,
            currentEditTaskId: null,
            isRecording: false,
            recordingTimer: null,
            recordingDuration: 0,

            send(id) {
                this.removeMessage(id);
            },

            sendWithReply(id, replyText) {
                // 先显示回复消息
                this.showReplyMessage(id, replyText);
                // 延迟后移除原消息
                setTimeout(() => {
                    this.removeMessage(id);
                }, 1000);
            },

            showReplyMessage(taskId, replyText) {
                // 创建回复消息卡片
                const replyCard = document.createElement('div');
                replyCard.className = 'flex space-x-3 mb-3 task-item transition-all duration-500 chat-bubble';
                replyCard.style.animation = 'slideDown 0.3s ease';
                replyCard.innerHTML = `
                    <img src="me.png" class="avatar-box chat-avatar" alt="我">
                    <div class="flex-1 glass-card p-4 border-l-2 border-[var(--wechat-green)]">
                        <div class="flex justify-between mb-2 text-[10px] font-bold">
                            <span class="text-[var(--wechat-green)]">我</span>
                            <span class="text-zinc-600">刚才</span>
                        </div>
                        <p class="text-[14px] text-zinc-200">${replyText}</p>
                    </div>
                `;

                // 插入到原消息前面
                const taskEl = document.getElementById(taskId);
                if (taskEl && taskEl.parentNode) {
                    taskEl.parentNode.insertBefore(replyCard, taskEl);

                    // 2秒后淡出回复消息
                    setTimeout(() => {
                        replyCard.style.opacity = '0';
                        replyCard.style.transform = 'translateY(-10px)';
                        setTimeout(() => replyCard.remove(), 300);
                    }, 2000);
                }
            },

            removeMessage(id) {
                try {
                    const el = document.getElementById(id);
                    if (!el) {
                        console.error('Element not found:', id);
                        return;
                    }

                    // 显示发送成功提示
                    this.showSendSuccessFeedback();

                    // 添加过渡效果 - 消息向右滑出并淡出
                    el.style.transition = "all 0.5s cubic-bezier(0.4, 0, 0.2, 1)";
                    el.style.transform = "translateX(120%)";
                    el.style.opacity = "0";
                    el.style.pointerEvents = "none";

                    setTimeout(() => {
                        // 完全移除元素
                        el.style.display = "none";
                        el.remove();

                        // 更新任务计数
                        this.tasks--;
                        this.processed++;

                        const taskCountEl = document.getElementById('task-count');
                        if (taskCountEl) taskCountEl.innerText = this.tasks;

                        // 更新统计
                        this.updateStats();

                        // 检查是否所有任务都已完成
                        const chatEmpty = document.getElementById('chat-empty');
                        const chatContainer = document.getElementById('chat-container');

                        if (this.tasks === 0) {
                            if (chatEmpty) chatEmpty.classList.remove('hidden');
                            if (chatContainer) chatContainer.style.display = 'none';
                        }
                    }, 500);
                } catch (error) {
                    console.error('Error in removeMessage function:', error);
                }
            },

            showSendSuccessFeedback() {
                try {
                    // 创建发送成功提示
                    const feedbackEl = document.createElement('div');
                    feedbackEl.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 glass-card px-6 py-4 rounded-xl z-[300] border border-[var(--wechat-green)]/50 shadow-2xl';
                    feedbackEl.style.animation = 'slideDown 0.3s ease';
                    feedbackEl.innerHTML = '<div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-[var(--wechat-green)]/20 flex items-center justify-center"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-[var(--wechat-green)]"><polyline points="20 6 9 17 4 12"></polyline></svg></div><div><p class="text-sm font-semibold text-white">✅ 消息已发送</p><p class="text-xs text-zinc-400 mt-0.5">发送成功</p></div></div>';

                    if (document.body) {
                        document.body.appendChild(feedbackEl);

                        // 2秒后自动移除
                        setTimeout(() => {
                            feedbackEl.style.opacity = '0';
                            feedbackEl.style.transform = 'translate(-50%, -10px)';
                            setTimeout(() => {
                                if (feedbackEl.parentNode) {
                                    feedbackEl.remove();
                                }
                            }, 300);
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Error showing feedback:', error);
                }
            },
            edit(taskId) {
                // 显示微信风格回复框
                const replyBox = document.getElementById('wechat-reply-box');
                if (!replyBox) {
                    console.error('Reply box not found');
                    return;
                }

                // 获取任务卡片元素
                const taskEl = document.getElementById(taskId);
                let draftText = '';

                if (taskEl) {
                    // 尝试提取"拟稿"内容 - 使用多种方式查找
                    let draftEl = taskEl.querySelector('div[class*="bg-white"]');
                    if (!draftEl) {
                        // 查找包含"拟稿"文本的元素
                        const allDivs = taskEl.querySelectorAll('div');
                        for (let div of allDivs) {
                            if (div.textContent && div.textContent.includes('拟稿')) {
                                draftEl = div;
                                break;
                            }
                        }
                    }

                    if (draftEl) {
                        const text = draftEl.textContent || '';
                        // 提取引号内的内容
                        const draftMatch = text.match(/拟稿[：:]\s*[""]([^""]+)[""]/);
                        if (draftMatch) {
                            draftText = draftMatch[1];
                        } else {
                            // 如果没有引号，提取"拟稿："之后的内容
                            draftText = text.replace(/拟稿[：:]\s*/, '').trim();
                            draftText = draftText.replace(/^[""]|[""]$/g, '');
                        }
                    }
                }

                // 移除 hidden 类并显示
                replyBox.classList.remove('hidden');
                replyBox.style.display = 'block';
                replyBox.style.animation = 'slideUp 0.3s ease';

                // 预填充输入框
                const textInput = document.getElementById('wechat-text-input');
                const sendBtn = document.getElementById('wechat-send-btn');
                const fileBtn = document.getElementById('wechat-file-btn');
                const inputMic = document.getElementById('wechat-input-mic');

                if (textInput) {
                    textInput.value = draftText;
                    textInput.style.height = 'auto';
                    textInput.style.height = Math.min(textInput.scrollHeight, 120) + 'px';

                    // 根据是否有内容显示/隐藏按钮
                    if (draftText.trim().length > 0) {
                        if (sendBtn) sendBtn.classList.remove('hidden');
                        if (fileBtn) fileBtn.classList.add('hidden');
                        if (inputMic) inputMic.style.display = 'none';
                    } else {
                        if (sendBtn) sendBtn.classList.add('hidden');
                        if (fileBtn) fileBtn.classList.remove('hidden');
                        if (inputMic) inputMic.style.display = 'flex';
                    }

                    setTimeout(() => {
                        textInput.focus();
                        // 将光标移到末尾
                        textInput.setSelectionRange(textInput.value.length, textInput.value.length);
                    }, 300);
                }

                // 保存当前任务ID
                this.currentEditTaskId = taskId;

                console.log('Edit box opened for task:', taskId, 'with draft:', draftText);
            },

            closeReplyBox() {
                const replyBox = document.getElementById('wechat-reply-box');
                if (replyBox) {
                    replyBox.style.animation = 'slideDown 0.3s ease';
                    setTimeout(() => {
                        replyBox.classList.add('hidden');
                        // 清空输入
                        const textInput = document.getElementById('wechat-text-input');
                        const sendBtn = document.getElementById('wechat-send-btn');
                        const fileBtn = document.getElementById('wechat-file-btn');
                        const inputMic = document.getElementById('wechat-input-mic');

                        if (textInput) {
                            textInput.value = '';
                            textInput.style.height = 'auto';
                        }
                        // 重置按钮状态
                        if (sendBtn) sendBtn.classList.add('hidden');
                        if (fileBtn) fileBtn.classList.remove('hidden');
                        if (inputMic) inputMic.style.display = 'flex';

                        // 隐藏语音和文件状态
                        const voiceStatus = document.getElementById('wechat-voice-status');
                        const fileProgress = document.getElementById('wechat-file-progress');
                        if (voiceStatus) voiceStatus.classList.add('hidden');
                        if (fileProgress) fileProgress.classList.add('hidden');
                        // 停止录音
                        if (this.isRecording) {
                            this.stopWechatVoice(false);
                        }
                        this.currentEditTaskId = null;
                    }, 300);
                }
            },

            sendWechatReply() {
                const textInput = document.getElementById('wechat-text-input');
                if (!textInput) return;

                const message = textInput.value.trim();
                if (!message && !this.isRecording) return;

                if (message) {
                    // 如果有任务ID，更新任务卡片中的"拟稿"内容
                    if (this.currentEditTaskId) {
                        this.updateTaskDraft(this.currentEditTaskId, message);
                    }

                    // 处理回复消息
                    this.showFeedback(`💬 已更新文案：${message}`);

                    // 清空输入并关闭回复框
                    textInput.value = '';
                    textInput.style.height = 'auto';
                    this.closeReplyBox();
                }
            },

            updateTaskDraft(taskId, newDraft) {
                const taskEl = document.getElementById(taskId);
                if (!taskEl) {
                    console.error('Task element not found:', taskId);
                    return;
                }

                // 查找"拟稿"区域 - 使用多种方式
                let draftEl = null;

                // 方法1: 查找包含"拟稿"文本的元素
                const allDivs = taskEl.querySelectorAll('div');
                for (let div of allDivs) {
                    if (div.textContent && div.textContent.includes('拟稿')) {
                        draftEl = div;
                        break;
                    }
                }

                // 方法2: 如果没找到，查找有特定样式的div
                if (!draftEl) {
                    draftEl = taskEl.querySelector('div.bg-white\\/5');
                }

                // 方法3: 如果还是没找到，创建一个新的
                if (!draftEl) {
                    const messageEl = taskEl.querySelector('p.text-zinc-200, p.text-\\[14px\\]');
                    if (messageEl) {
                        draftEl = document.createElement('div');
                        draftEl.className = 'bg-white/5 border border-white/5 p-4 rounded-xl mb-5 text-sm italic text-zinc-300 leading-relaxed';
                        // 插入到消息后面，按钮前面
                        const buttonContainer = taskEl.querySelector('.flex.gap-2');
                        if (buttonContainer) {
                            buttonContainer.parentNode.insertBefore(draftEl, buttonContainer);
                        } else {
                            messageEl.parentNode.appendChild(draftEl);
                        }
                    }
                }

                if (draftEl) {
                    // 更新拟稿内容
                    draftEl.innerHTML = `拟稿："${newDraft}"`;

                    // 添加更新动画效果
                    draftEl.style.opacity = '0';
                    draftEl.style.transform = 'translateY(-5px)';
                    setTimeout(() => {
                        draftEl.style.transition = 'all 0.3s ease';
                        draftEl.style.opacity = '1';
                        draftEl.style.transform = 'translateY(0)';
                    }, 50);

                    console.log('Draft updated successfully:', newDraft);
                } else {
                    console.error('Could not find or create draft element');
                }
            },

            toggleWechatVoice() {
                if (this.isRecording) {
                    this.stopWechatVoice(true);
                } else {
                    this.startWechatVoice();
                }
            },

            startWechatVoice() {
                this.isRecording = true;
                this.recordingDuration = 0;

                const statusEl = document.getElementById('wechat-voice-status');
                const statusText = document.getElementById('wechat-voice-status-text');
                const waveform = document.getElementById('wechat-voice-waveform');
                const voiceBtn = document.getElementById('wechat-voice-btn');

                if (statusEl) statusEl.classList.remove('hidden');
                if (statusText) statusText.textContent = '正在录音...';
                if (voiceBtn) {
                    voiceBtn.style.background = 'rgba(239, 68, 68, 0.3)';
                    voiceBtn.style.borderColor = 'rgba(239, 68, 68, 0.5)';
                }

                // 生成波形动画
                if (waveform) {
                    waveform.innerHTML = '';
                    for (let i = 0; i < 8; i++) {
                        const bar = document.createElement('div');
                        bar.className = 'voice-wave-bar';
                        waveform.appendChild(bar);
                    }
                }

                // 模拟录音计时
                this.recordingTimer = setInterval(() => {
                    this.recordingDuration++;
                    if (statusText) {
                        const minutes = Math.floor(this.recordingDuration / 60);
                        const seconds = this.recordingDuration % 60;
                        statusText.textContent = `正在录音... ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    }
                }, 1000);
            },

            stopWechatVoice(save) {
                if (!this.isRecording) return;

                this.isRecording = false;
                if (this.recordingTimer) {
                    clearInterval(this.recordingTimer);
                    this.recordingTimer = null;
                }

                const statusEl = document.getElementById('wechat-voice-status');
                const statusText = document.getElementById('wechat-voice-status-text');
                const voiceBtn = document.getElementById('wechat-voice-btn');
                const textInput = document.getElementById('wechat-text-input');

                if (voiceBtn) {
                    voiceBtn.style.background = '';
                    voiceBtn.style.borderColor = '';
                }

                if (save) {
                    // 模拟语音转文本
                    const mockTranscriptions = [
                        '好的，我明白了',
                        '这个方案可以，按你说的办',
                        '需要再考虑一下，稍后回复',
                        '没问题，我会处理'
                    ];

                    const transcription = mockTranscriptions[Math.floor(Math.random() * mockTranscriptions.length)];

                    if (statusText) {
                        statusText.textContent = '✅ 语音识别完成';
                    }

                    setTimeout(() => {
                        if (textInput) {
                            textInput.value = transcription;
                            textInput.style.height = 'auto';
                            textInput.style.height = Math.min(textInput.scrollHeight, 100) + 'px';
                        }
                        if (statusEl) statusEl.classList.add('hidden');
                    }, 1000);
                } else {
                    if (statusEl) statusEl.classList.add('hidden');
                }
            },

            handleWechatFileUpload() {
                const fileInput = document.getElementById('wechat-file-input');
                if (fileInput) {
                    fileInput.click();
                }
            },

            processWechatFileUpload(files) {
                const progressContainer = document.getElementById('wechat-file-progress');
                const progressBar = document.getElementById('wechat-file-progress-bar');
                const statusText = document.getElementById('wechat-file-status');

                if (!progressContainer) return;

                progressContainer.classList.remove('hidden');

                Array.from(files).forEach((file, index) => {
                    const fileName = file.name;

                    // 模拟上传进度
                    let progress = 0;
                    const uploadInterval = setInterval(() => {
                        progress += 10;
                        if (progressBar) progressBar.style.width = progress + '%';
                        if (statusText) statusText.textContent = `正在上传 ${fileName}... ${progress}%`;

                        if (progress >= 100) {
                            clearInterval(uploadInterval);

                            setTimeout(() => {
                                if (statusText) statusText.textContent = `✅ ${fileName} 上传完成`;

                                setTimeout(() => {
                                    progressContainer.classList.add('hidden');
                                    if (progressBar) progressBar.style.width = '0%';
                                    this.showFeedback(`📎 文件 ${fileName} 已发送`);
                                }, 1000);
                            }, 500);
                        }
                    }, 200);
                });
            },

            showFeedback(message) {
                // 创建临时反馈消息
                const feedbackEl = document.createElement('div');
                feedbackEl.className = 'glass-card p-4 mb-3 border border-[var(--wechat-green)]/30 rounded-xl';
                feedbackEl.style.animation = 'slideDown 0.3s ease';
                feedbackEl.innerHTML = `
                    <div class="text-sm text-zinc-200">${message}</div>
                `;

                const chatContainer = document.getElementById('chat-container');
                if (chatContainer) {
                    chatContainer.insertBefore(feedbackEl, chatContainer.firstChild);

                    setTimeout(() => {
                        feedbackEl.style.opacity = '0';
                        feedbackEl.style.transform = 'translateY(-10px)';
                        setTimeout(() => feedbackEl.remove(), 300);
                    }, 2000);
                }
            },

            initWechatReplyBox() {
                // 关闭按钮
                const closeBtn = document.getElementById('close-reply-box');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => this.closeReplyBox());
                }

                // 获取所有需要的元素
                const sendBtn = document.getElementById('wechat-send-btn');
                const fileBtn = document.getElementById('wechat-file-btn');
                const textInput = document.getElementById('wechat-text-input');
                const inputMic = document.getElementById('wechat-input-mic');
                const fileInput = document.getElementById('wechat-file-input');
                const voiceBtn = document.getElementById('wechat-voice-btn');
                const voiceStopBtn = document.getElementById('wechat-voice-stop-btn');
                const voiceCancelBtn = document.getElementById('wechat-voice-cancel-btn');

                // 发送按钮
                if (sendBtn) {
                    sendBtn.addEventListener('click', () => this.sendWechatReply());
                }

                // 语音按钮
                if (voiceBtn) {
                    voiceBtn.addEventListener('click', () => this.toggleWechatVoice());
                }

                // 文件按钮
                if (fileBtn) {
                    fileBtn.addEventListener('click', () => this.handleWechatFileUpload());
                }
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => {
                        if (e.target.files.length > 0) {
                            this.processWechatFileUpload(e.target.files);
                        }
                    });
                }

                // 语音控制按钮
                if (voiceStopBtn) {
                    voiceStopBtn.addEventListener('click', () => this.stopWechatVoice(true));
                }
                if (voiceCancelBtn) {
                    voiceCancelBtn.addEventListener('click', () => this.stopWechatVoice(false));
                }

                // 文本输入框自动调整高度和显示/隐藏逻辑

                if (textInput) {
                    // 输入时自动调整高度
                    textInput.addEventListener('input', function() {
                        this.style.height = 'auto';
                        this.style.height = Math.min(this.scrollHeight, 120) + 'px';

                        // 根据输入内容显示/隐藏发送按钮和麦克风图标
                        const hasText = this.value.trim().length > 0;
                        if (sendBtn) {
                            if (hasText) {
                                sendBtn.classList.remove('hidden');
                                if (fileBtn) fileBtn.classList.add('hidden');
                            } else {
                                sendBtn.classList.add('hidden');
                                if (fileBtn) fileBtn.classList.remove('hidden');
                            }
                        }
                        if (inputMic) {
                            inputMic.style.display = hasText ? 'none' : 'flex';
                        }
                    });

                    // 回车发送（Shift+Enter换行）
                    textInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            chatActions.sendWechatReply();
                        }
                    });

                    // 初始状态：隐藏发送按钮，显示文件按钮和麦克风图标
                    if (sendBtn) sendBtn.classList.add('hidden');
                    if (inputMic) inputMic.style.display = 'flex';
                }
            },

            updateStats() {
                const pendingEl = document.getElementById('stat-pending');
                const processedEl = document.getElementById('stat-processed');
                // 精简版状态栏只显示待办和已处理

                // 日志页面的统计元素
                const logPendingEl = document.getElementById('log-stat-pending');
                const logProcessedEl = document.getElementById('log-stat-processed');
                const logAnalyzingEl = document.getElementById('log-stat-analyzing');
                const logTodayEl = document.getElementById('log-today-processed');

                if (pendingEl) pendingEl.textContent = this.tasks;
                if (processedEl) processedEl.textContent = this.processed;

                // 同步到日志页面
                if (logPendingEl) logPendingEl.textContent = this.tasks;
                if (logProcessedEl) logProcessedEl.textContent = this.processed;
                if (logAnalyzingEl) logAnalyzingEl.textContent = this.analyzing;
                if (logTodayEl) logTodayEl.textContent = this.processed + this.tasks;
            }
        };

        // AI状态巡视系统
        const aiStatusSystem = {
            statusInterval: null,
            statusMessages: [{
                text: '正在分析决策请求...',
                subtext: '实时监控中'
            }, {
                text: '正在评估风险等级...',
                subtext: '深度分析中'
            }, {
                text: '正在生成决策建议...',
                subtext: '智能处理中'
            }, {
                text: '正在检查合规性...',
                subtext: '规则匹配中'
            }, {
                text: '正在优化回复方案...',
                subtext: '策略生成中'
            }, {
                text: '正在监控新消息...',
                subtext: '持续巡视中'
            }, {
                text: '正在学习新知识...',
                subtext: '知识更新中'
            }, {
                text: '正在同步决策逻辑...',
                subtext: '系统优化中'
            }],
            currentIndex: 0,

            start() {
                // 立即更新一次
                this.updateStatus();

                // 每3-5秒随机切换状态
                this.statusInterval = setInterval(() => {
                    this.updateStatus();
                }, 3000 + Math.random() * 2000);
            },

            stop() {
                if (this.statusInterval) {
                    clearInterval(this.statusInterval);
                    this.statusInterval = null;
                }
            },

            updateStatus() {
                const statusText = document.getElementById('ai-status-text');
                const statusSubtext = document.getElementById('ai-status-subtext');
                const logStatusText = document.getElementById('log-ai-status-text');
                const logStatusSubtext = document.getElementById('log-ai-status-subtext');

                if (!statusText || !statusSubtext) return;

                // 随机选择一个状态（避免连续相同）
                let newIndex;
                do {
                    newIndex = Math.floor(Math.random() * this.statusMessages.length);
                } while (newIndex === this.currentIndex && this.statusMessages.length > 1);

                this.currentIndex = newIndex;
                const status = this.statusMessages[this.currentIndex];

                // 淡出效果
                statusText.style.opacity = '0.5';
                statusSubtext.style.opacity = '0.5';
                if (logStatusText) logStatusText.style.opacity = '0.5';
                if (logStatusSubtext) logStatusSubtext.style.opacity = '0.5';

                setTimeout(() => {
                    statusText.textContent = status.text;
                    statusSubtext.textContent = status.subtext;
                    if (logStatusText) logStatusText.textContent = status.text;
                    if (logStatusSubtext) logStatusSubtext.textContent = status.subtext;

                    // 淡入效果
                    statusText.style.opacity = '1';
                    statusSubtext.style.opacity = '1';
                    if (logStatusText) logStatusText.style.opacity = '1';
                    if (logStatusSubtext) logStatusSubtext.style.opacity = '1';
                }, 200);
            }
        };

        // 初始化AI状态系统
        document.addEventListener('DOMContentLoaded', () => {
            // 只在聊天视图启动
            if (app.currentView === 'chat') {
                aiStatusSystem.start();
            }
        });

        // 日志数据
        const logData = {
            '2026-02-01': [{
                time: '15:30',
                type: '决策发送',
                content: '向字节跳动发送了修订后的排他条款回复。',
                highlight: true
            }, {
                time: '14:20',
                type: '知识吸收',
                content: '解析《2026排他准则》，更新决策逻辑。',
                highlight: false
            }, {
                time: '12:00',
                type: '自动审批',
                content: '已自动打回老陈的超限差旅报销申请。',
                highlight: false
            }, {
                time: '10:45',
                type: '系统维护',
                content: 'IDC 波动确认已解决，备用链路正常运行。',
                highlight: false
            }, {
                time: '09:00',
                type: '简报生成',
                content: '今日行业动态已汇总',
                highlight: false,
                faded: true
            }],
            '2026-01-31': [{
                time: '21:30',
                type: '',
                content: '自动改签明日去深圳的航班。',
                highlight: false
            }, {
                time: '19:00',
                type: '',
                content: '吸收《个人沟通偏好模型》权重。',
                highlight: false
            }, {
                time: '16:00',
                type: '',
                content: '自动忽略 42 封低优先级垃圾邮件。',
                highlight: false
            }, {
                time: '14:00',
                type: '',
                content: '核心管理层会议要点已自动速记。',
                highlight: false
            }, {
                time: '10:00',
                type: '',
                content: '财务异常预警：办公耗材支出超出红线。',
                highlight: false
            }],
            '2026-01-30': [{
                time: '18:00',
                type: '系统更新',
                content: '完成核心决策引擎版本升级至 v3.2。',
                highlight: false
            }, {
                time: '15:30',
                type: '知识吸收',
                content: '学习并整合新的行业合规标准。',
                highlight: false
            }, {
                time: '12:00',
                type: '自动审批',
                content: '批准了 5 项常规采购申请。',
                highlight: false
            }, {
                time: '09:00',
                type: '简报生成',
                content: '生成周度业务分析报告。',
                highlight: false
            }]
        };

        const logActions = {
                currentDate: '2026-02-01',

                selectDate(date, element) {
                    this.currentDate = date;

                    // 更新日期选择器状态
                    document.querySelectorAll('.date-chip').forEach(chip => {
                        chip.classList.remove('active');
                        chip.classList.remove('bg-white', 'text-black', 'font-black');
                        chip.classList.add('bg-zinc-900/80', 'text-zinc-400');
                    });

                    if (element) {
                        element.classList.add('active');
                        element.classList.remove('bg-zinc-900/80', 'text-zinc-400');
                        element.classList.add('bg-white', 'text-black', 'font-black');
                    }

                    // 加载对应日期的日志
                    this.loadLogs(date);
                },

                loadLogs(date) {
                    const content = document.getElementById('log-content');
                    const logs = logData[date] || [];

                    // 淡出效果
                    content.style.opacity = '0.3';

                    setTimeout(() => {
                                // 生成日志HTML
                                let html = '';

                                // 添加日期分隔符
                                const logDate = new Date(date);
                                const dateStr = `${logDate.getFullYear()}年${logDate.getMonth() + 1}月${logDate.getDate()}日`;
                                html += `<div class="text-[10px] text-zinc-700 uppercase font-black py-4 tracking-wider">${dateStr}</div>`;

                                // 生成日志条目
                                logs.forEach((log) => {
                                            const dotSize = log.highlight ? 'w-3 h-3' : 'w-2.5 h-2.5';
                                            const dotColor = log.highlight ? 'bg-[var(--accent-blue)]' : (log.faded ? 'bg-zinc-800' : 'bg-zinc-700');
                                            const textColor = log.highlight ? 'text-zinc-300' : (log.faded ? 'text-zinc-500' : 'text-zinc-400');
                                            const timeColor = log.highlight ? 'text-zinc-500' : (log.faded ? 'text-zinc-700' : 'text-zinc-600');
                                            const faded = log.faded ? 'opacity-50' : '';
                                            const fontSize = log.type ? '13px' : '12px';

                                            html += `
                            <div class="relative log-item ${faded}">
                                <div class="absolute -left-[25px] top-1 ${dotSize} rounded-full ${dotColor} log-dot border-2 border-black"></div>
                                ${log.type ? `<p class="text-[10px] ${timeColor} mb-1 uppercase tracking-tighter font-semibold">${log.time} / ${log.type}</p>` : ''}
                                <p class="text-[${fontSize}] ${textColor} ${log.type ? 'italic font-medium' : 'italic'} leading-relaxed">${log.type ? '' : log.time + ' / '}${log.content}</p>
                            </div>
                        `;
                    });
                    
                    content.innerHTML = html;
                    
                    // 淡入效果
                    content.style.opacity = '1'; 
                }, 200);
            },
            
            openCalendar() {
                const calendarModal = document.getElementById('calendar-modal');
                if (calendarModal) {
                    calendarModal.classList.remove('hidden');
                    this.renderCalendar();
                }
            },
            
            closeCalendar() {
                const calendarModal = document.getElementById('calendar-modal');
                if (calendarModal) {
                    calendarModal.classList.add('hidden');
                }
            },
            
            renderCalendar() {
                const calendarGrid = document.getElementById('calendar-grid');
                if (!calendarGrid) return;
                
                // 使用当前选中的日期，如果没有则使用今天
                const selectedDate = new Date(this.currentDate || new Date());
                const year = selectedDate.getFullYear();
                const month = selectedDate.getMonth();
                
                // 获取当月第一天和最后一天
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();
                
                // 生成日历HTML
                let html = '';
                
                // 星期标题
                const weekDays = ['日', '一', '二', '三', '四', '五', '六'];
                html += '<div class="grid grid-cols-7 gap-2 mb-3">';
                weekDays.forEach(day => {
                    html += `<div class="text-center text-xs text-zinc-500 font-semibold py-2">${day}</div>`;
                });
                html += '</div>';
                
                // 日期网格
                html += '<div class="grid grid-cols-7 gap-2">';
                
                // 填充空白
                for (let i = 0; i < startingDayOfWeek; i++) {
                    html += '<div></div>';
                }
                
                // 填充日期
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const hasLogs = logData[dateStr] !== undefined;
                    const today = new Date();
                    const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                    const isSelected = dateStr === this.currentDate;
                    
                    let classes = 'calendar-day text-center py-2 rounded-lg text-sm transition-all cursor-pointer';
                    
                    if (isSelected) {
                        classes += ' bg-white text-black font-bold';
                    } else if (isToday) {
                        classes += ' bg-zinc-800 text-white border border-zinc-700';
                    } else if (hasLogs) {
                        classes += ' bg-zinc-900/50 text-zinc-300 hover:bg-zinc-800';
                    } else {
                        classes += ' text-zinc-600 hover:bg-zinc-900/30';
                    }
                    
                    html += `<div class="${classes}" data-date="${dateStr}" onclick="logActions.selectDateFromCalendar('${dateStr}')">${day}</div>`;
                }
                
                html += '</div>';
                
                calendarGrid.innerHTML = html;
                
                // 更新月份显示
                const monthDisplay = document.getElementById('calendar-month');
                if (monthDisplay) {
                    monthDisplay.textContent = `${year}年${month + 1}月`;
                }
            },
            
            selectDateFromCalendar(dateStr) {
                this.closeCalendar();
                
                // 查找对应的日期选择器元素
                const dateChips = document.querySelectorAll('.date-chip');
                let targetElement = null;
                
                // 检查是否在快速选择列表中
                dateChips.forEach(chip => {
                    if (chip.dataset.date === dateStr) {
                        targetElement = chip;
                    }
                });
                
                // 选择日期（如果找到对应的元素则更新UI，否则只更新日志内容）
                if (targetElement) {
                    this.selectDate(dateStr, targetElement);
                } else {
                    // 如果不在快速选择列表中，只更新日志内容
                    this.currentDate = dateStr;
                    this.loadLogs(dateStr);
                }
            }
        };
        
        // 初始化加载默认日期的日志
        document.addEventListener('DOMContentLoaded', () => {
            logActions.loadLogs('2026-02-01');
        });

        // 知识资产数据
        const assetsData = [
            {
                name: '2026战略合作排他准则.pdf',
                badge: null,
                highlighted: true,
                aiExtract: '提取了排他协议核心规则：12个月期限上限、对等接口权限要求、违约金需覆盖3年收益。已应用于战略合作决策流程。',
                summary: '规定了战略合作伙伴关系的排他性条款，核心约束包括：合作期限上限12个月，双方享有对等接口权限，违约金需覆盖3年预期收益。适用于S级战略资源置换场景。',
                keywords: ['排他协议', '12个月上限', '对等接口权限', '违约金', 'S级资源', '战略合作'],
                logic: '当收到涉及排他协议的决策请求时，优先检查期限是否超过12个月。若超过，需评估是否匹配S级资源置换。回复时强调对等权限和违约金覆盖3年收益的要求。'
            },
            {
                name: 'CEO 个人沟通偏好模型.json',
                badge: '已习得',
                highlighted: false,
                aiExtract: '提取了紧急处理流程：结论先行、数据驱动、避免不确定词汇。已应用于所有CEO沟通场景。',
                summary: '基于历史沟通数据训练的CEO沟通风格模型。偏好简洁直接、数据驱动、结果导向的表达方式。避免冗长铺垫，重视时间效率。',
                keywords: ['沟通风格', '简洁直接', '数据驱动', '结果导向', '时间效率'],
                logic: '所有发送给CEO的决策建议和报告，需遵循"结论先行"原则。首句即核心观点，后续用数据支撑。避免使用"可能"、"或许"等不确定词汇。'
            },
            {
                name: '核心管理层期权回购协议.pdf',
                badge: 'V2.1',
                highlighted: false,
                aiExtract: '提取了期权回购标准流程：行权条件检查、估值计算方法、自动生成回购时间表。已应用于期权管理决策。',
                summary: '定义了核心管理层期权回购的标准流程和定价机制。包含行权条件、回购触发条件、估值方法（基于最近一轮融资估值）和支付时间表。',
                keywords: ['期权回购', '行权条件', '估值方法', '融资估值', '支付时间表'],
                logic: '涉及期权回购的审批流程，自动检查是否符合行权条件。估值计算需引用最近一轮融资的估值数据。若触发回购条件，自动生成回购时间表和资金需求预测。'
            },
            {
                name: '研发部 2026 成本红线指标.xlsx',
                badge: null,
                highlighted: false,
                aiExtract: '提取了成本红线检查机制：自动对比预算上限、风险等级标注、CEO审批触发条件。已应用于研发支出审批。',
                summary: '定义了研发部门2026年各项成本的红线指标。包括人力成本、基础设施、云服务、第三方工具等分类预算上限。超出红线需CEO审批。',
                keywords: ['成本红线', '人力成本', '基础设施', '云服务', '预算上限', 'CEO审批'],
                logic: '所有研发相关的支出申请，自动对比成本红线。若接近或超出红线，在决策建议中标注风险等级，并提示需要CEO审批。定期生成成本趋势分析。'
            },
            {
                name: '友商竞品架构异动情报集.txt',
                badge: null,
                highlighted: false,
                aiExtract: '提取了竞品分析框架：技术栈对比、架构优劣评估、竞争视角决策支持。已应用于技术选型决策。',
                summary: '持续更新的竞品技术架构变化情报。包含技术栈迁移、基础设施调整、新功能架构设计等信息。用于技术决策参考和竞争分析。',
                keywords: ['竞品分析', '技术架构', '技术栈', '基础设施', '竞争情报'],
                logic: '当涉及技术选型或架构决策时，自动检索相关竞品情报。在决策建议中对比我方方案与竞品方案的优劣，提供竞争视角的分析。'
            },
            {
                name: 'Q1 融资防御补充条款.doc',
                badge: null,
                highlighted: false,
                aiExtract: '提取了融资防御检查规则：反稀释条款、一票否决权、法务审核触发条件。已应用于重大决策审核。',
                summary: 'Q1季度融资防御策略的补充条款。包含反稀释条款、优先认购权、董事会席位安排、关键决策一票否决权等保护性条款。',
                keywords: ['融资防御', '反稀释', '优先认购权', '董事会席位', '一票否决权'],
                logic: '涉及融资、股权变更、重大决策时，自动检查是否符合防御条款。若存在冲突，在决策建议中明确标注风险，并建议法务部门审核。'
            },
            {
                name: '跨境数据流通准则 2026版.pdf',
                badge: null,
                highlighted: false,
                aiExtract: '提取了数据合规检查流程：数据分类标准、出境审批流程、合规风险标记机制。已应用于跨境数据传输决策。',
                summary: '2026年最新版跨境数据流通合规准则。明确了数据分类标准、出境审批流程、数据加密要求、存储位置限制等合规要求。',
                keywords: ['跨境数据', '数据合规', '数据分类', '出境审批', '数据加密', '存储限制'],
                logic: '涉及数据出境、跨境传输的决策，自动检查是否符合合规准则。根据数据分类（敏感/一般）提供相应的审批流程建议。若存在合规风险，标记为高优先级。'
            }
        ];

        const assetActions = {
            showStatusIsland(message) {
                const island = document.getElementById('status-island');
                const text = island.querySelector('.status-island-text');
                if (island && text) {
                    text.textContent = message;
                    island.classList.add('active');
                }
            },
            
            hideStatusIsland() {
                const island = document.getElementById('status-island');
                if (island) {
                    island.classList.remove('active');
                }
            },
            
            generateEvolutionLog(fileName, extractResult) {
                // 生成进化日志并添加到日志数据中
                const now = new Date();
                const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
                
                // 确保日志数据中存在今天的日期
                if (!logData[dateStr]) {
                    logData[dateStr] = [];
                }
                
                // 在日志开头插入新的进化日志
                logData[dateStr].unshift({
                    time: timeStr,
                    type: '知识进化',
                    content: `完成《${fileName}》分析，${extractResult}`,
                    highlight: true
                });
                
                // 如果当前在日志视图，刷新显示
                if (app.currentView === 'log' && logActions.currentDate === dateStr) {
                    logActions.loadLogs(dateStr);
                }
            },
            
            simulateAIAnalysis(fileName) {
                // 模拟AI分析，生成提取结果
                const extractResults = [
                    `提取了${fileName.split('.')[0]}的核心规则和决策流程。已应用于相关决策场景。`,
                    `提取了${fileName.split('.')[0]}的关键约束条件和审批机制。已整合到决策引擎。`,
                    `提取了${fileName.split('.')[0]}的紧急处理流程和风险控制点。已应用于自动化审批。`,
                    `提取了${fileName.split('.')[0]}的合规要求和检查标准。已应用于合规决策。`
                ];
                
                return extractResults[Math.floor(Math.random() * extractResults.length)];
            },
            
            upload() {
                // 创建隐藏的文件输入元素
                const input = document.createElement('input');
                input.type = 'file';
                input.multiple = true;
                input.accept = '.pdf,.doc,.docx,.xlsx,.xls,.txt,.json,.md';
                
                // 获取上传按钮
                const btn = document.querySelector('.upload-btn');
                const btnText = btn.querySelector('span');
                const originalText = btnText.textContent;
                
                input.onchange = (e) => {
                    const files = e.target.files;
                    if (files.length > 0) {
                        // 显示上传提示
                        btnText.textContent = '上传中...';
                        btn.style.opacity = '0.6';
                        btn.style.pointerEvents = 'none';
                        
                        // 显示灵动岛状态
                        this.showStatusIsland('正在重构人格记忆...');
                        
                        // 模拟上传和分析过程
                        setTimeout(() => {
                            // 处理每个文件
                            files.forEach((file, index) => {
                                setTimeout(() => {
                                    // 模拟AI分析
                                    const extractResult = this.simulateAIAnalysis(file.name);
                                    
                                    // 添加到知识资产列表
                                    const newAsset = {
                                        name: file.name,
                                        badge: null,
                                        highlighted: false,
                                        aiExtract: extractResult,
                                        summary: `已上传并分析的文档：${file.name}。AI已完成知识提取和逻辑转化。`,
                                        keywords: ['新上传', 'AI分析', '知识提取'],
                                        logic: `该文档的知识已整合到决策引擎中，将在相关场景自动应用。`
                                    };
                                    
                                    assetsData.unshift(newAsset);
                                    
                                    // 生成进化日志
                                    this.generateEvolutionLog(file.name, extractResult);
                                    
                                    // 如果是最后一个文件，完成处理
                                    if (index === files.length - 1) {
                                        // 刷新资产列表
                                        setTimeout(() => {
                                            this.renderAssets();
                                            
                                            // 隐藏灵动岛
                                            setTimeout(() => {
                                                this.hideStatusIsland();
                                            }, 500);
                                            
                                            // 恢复按钮状态
                                            btnText.textContent = originalText;
                                            btn.style.opacity = '1';
                                            btn.style.pointerEvents = 'auto';
                                        }, 300);
                                    }
                                }, index * 1500); // 每个文件间隔1.5秒
                            });
                        }, 500);
                    }
                };
                
                // 如果用户取消选择，确保按钮状态正常
                input.oncancel = () => {
                    btnText.textContent = originalText;
                    btn.style.opacity = '1';
                    btn.style.pointerEvents = 'auto';
                    this.hideStatusIsland();
                };
                
                input.click();
            },
            
            renderAssets() {
                const container = document.getElementById('assets-list');
                if (!container) return;
                
                container.innerHTML = assetsData.map((asset, index) => {
                    const borderClass = asset.highlighted ? 'border-l-4 border-[var(--wechat-green)]' : 'border-l-2 border-zinc-700/30';
                    const badgeHtml = asset.badge ? `<span class="asset-badge">${asset.badge}</span>` : '';
                    const aiExtractHtml = asset.aiExtract ? `<div class="ai-extract-result">AI 提取结果：${asset.aiExtract}</div>` : '';
                    
                    return `
                        <div class="glass-card asset-card p-5 ${borderClass}" data-index="${index}">
                            <div class="asset-header">
                                <div class="flex-1">
                                    <p class="asset-title">${asset.name}</p>
                                    ${aiExtractHtml}
                                </div>
                                ${badgeHtml}
                                <button class="asset-expand-btn ml-2" onclick="assetActions.toggleExpand(${index})">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-400">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="asset-details" id="asset-details-${index}">
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="8" x2="12" y2="12"></line>
                                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                        </svg>
                                        核心摘要
                                    </div>
                                    <div class="asset-section-content">${asset.summary}</div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                        </svg>
                                        关键词提取
                                    </div>
                                    <div class="asset-keywords">
                                        ${asset.keywords.map(keyword => `<span class="asset-keyword">${keyword}</span>`).join('')}
                                    </div>
                                </div>
                                <div class="asset-section">
                                    <div class="asset-section-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        分身逻辑转化
                                    </div>
                                    <div class="asset-section-content">${asset.logic}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            },
            
            toggleExpand(index) {
                const card = document.querySelector(`.asset-card[data-index="${index}"]`);
                const details = document.getElementById(`asset-details-${index}`);
                const btn = card.querySelector('.asset-expand-btn');
                
                if (!card || !details || !btn) return;
                
                const isExpanded = card.classList.contains('expanded');
                
                if (isExpanded) {
                    card.classList.remove('expanded');
                    details.classList.remove('expanded');
                    btn.classList.remove('expanded');
                } else {
                    card.classList.add('expanded');
                    details.classList.add('expanded');
                    btn.classList.add('expanded');
                }
            },
            
            refreshAssets() {
                this.renderAssets();
            }
        };
        
        // 微信影子跟踪数据
        const wechatMessages = [
            {
                sender: '字节跳动 VP',
                time: '15:30',
                content: '关于排他协议，如果无法缩短至 3 个月，我们可能无法推进 Q1 预算。',
                type: 'decision',
                tag: '请示',
                category: '决策点'
            },
            {
                sender: '研发总监 老陈',
                time: '14:45',
                content: 'IDC 节点出现瞬间波动，已自动执行备用链路切换，目前服务稳定。',
                type: 'decision',
                tag: '汇报',
                category: '决策点'
            },
            {
                sender: '财务审核部',
                time: '14:20',
                content: 'Q1 季度预算报表已生成，核心支出增长 12%，是否现在调阅详细项？',
                type: 'decision',
                tag: '请示',
                category: '决策点'
            },
            {
                sender: '张总',
                time: '13:50',
                content: '👍',
                type: 'noise',
                tag: '表情包',
                category: '噪音'
            },
            {
                sender: '市场部小王',
                time: '13:45',
                content: '收到，谢谢老板！',
                type: 'noise',
                tag: '确认回复',
                category: '噪音'
            },
            {
                sender: '李总',
                time: '13:30',
                content: '已领取红包',
                type: 'noise',
                tag: '领红包',
                category: '噪音'
            },
            {
                sender: '法务部',
                time: '12:15',
                content: '关于期权回购协议的争议条款，需要您确认是否接受对方提出的修改建议。',
                type: 'decision',
                tag: '争议',
                category: '决策点'
            },
            {
                sender: '人事部',
                time: '11:30',
                content: '核心管理层期权回购申请已提交，请审批。',
                type: 'decision',
                tag: '请示',
                category: '决策点'
            },
            {
                sender: '产品经理',
                time: '11:00',
                content: '😊 好的，明白了',
                type: 'noise',
                tag: '表情包',
                category: '噪音'
            },
            {
                sender: 'CTO',
                time: '10:45',
                content: '技术架构调整方案已准备，涉及成本增加约 15%，需要您决策。',
                type: 'decision',
                tag: '请示',
                category: '决策点'
            }
        ];

        const wechatTracking = {
            monitoringInterval: null,
            messages: [...wechatMessages],
            
            startMonitoring() {
                // 立即渲染一次
                this.renderMessages();
                
                // 每30秒巡检一次（模拟）
                this.monitoringInterval = setInterval(() => {
                    this.simulateNewMessage();
                }, 30000);
            },
            
            stopMonitoring() {
                if (this.monitoringInterval) {
                    clearInterval(this.monitoringInterval);
                    this.monitoringInterval = null;
                }
            },
            
            simulateNewMessage() {
                // 模拟新消息（随机生成）
                const senders = ['字节跳动 VP', '研发总监 老陈', '财务审核部', '法务部', 'CTO', '市场部小王'];
                const decisionContents = [
                    '关于Q2预算调整，需要您确认。',
                    '新项目启动申请，涉及资金 500 万，请审批。',
                    '合作伙伴协议条款存在争议，需要您决策。',
                    '技术选型方案已准备，请确认最终方案。'
                ];
                const noiseContents = [
                    '👍',
                    '收到，谢谢！',
                    '已领取红包',
                    '😊 好的',
                    '明白了'
                ];
                
                const isDecision = Math.random() > 0.4; // 60% 概率是决策点
                const sender = senders[Math.floor(Math.random() * senders.length)];
                const now = new Date();
                const time = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                
                const newMessage = {
                    sender: sender,
                    time: time,
                    content: isDecision 
                        ? decisionContents[Math.floor(Math.random() * decisionContents.length)]
                        : noiseContents[Math.floor(Math.random() * noiseContents.length)],
                    type: isDecision ? 'decision' : 'noise',
                    tag: isDecision ? '请示' : (Math.random() > 0.5 ? '表情包' : '确认回复'),
                    category: isDecision ? '决策点' : '噪音'
                };
                
                // 添加到消息列表开头
                this.messages.unshift(newMessage);
                
                // 限制消息数量
                if (this.messages.length > 50) {
                    this.messages = this.messages.slice(0, 50);
                }
                
                // 重新渲染
                this.renderMessages();
            },
            
            renderMessages() {
                const container = document.getElementById('wechat-messages');
                if (!container) return;
                
                const decisionCount = this.messages.filter(m => m.type === 'decision').length;
                const noiseCount = this.messages.filter(m => m.type === 'noise').length;
                const totalCount = this.messages.length;
                
                // 更新统计
                const totalEl = document.getElementById('wechat-total-count');
                const decisionEl = document.getElementById('wechat-decision-count');
                const noiseEl = document.getElementById('wechat-noise-count');
                
                if (totalEl) totalEl.textContent = totalCount;
                if (decisionEl) decisionEl.textContent = decisionCount;
                if (noiseEl) noiseEl.textContent = noiseCount;
                
                // 渲染消息列表
                container.innerHTML = this.messages.map(msg => {
                    const messageClass = msg.type === 'decision' ? 'decision' : 'noise';
                    const tagClass = msg.type === 'decision' ? 'wechat-tag-decision' : 'wechat-tag-noise';
                    const tagIcon = msg.type === 'decision' ? '⚡' : '🔇';
                    
                    return `
                        <div class="glass-card wechat-message p-4 ${messageClass}">
                            <div class="wechat-message-header">
                                <span class="wechat-message-sender">${msg.sender}</span>
                                <span class="wechat-message-time">${msg.time}</span>
                            </div>
                            <div class="wechat-message-content">${msg.content}</div>
                            <div class="flex items-center gap-2">
                                <span class="wechat-message-tag ${tagClass}">
                                    ${tagIcon} ${msg.tag}
                                </span>
                                <span class="wechat-message-tag wechat-tag-type">
                                    ${msg.category}
                                </span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        };

        // 任务与日程数据
        const tasksData = [
            {
                id: 1,
                title: '撰写并发送报告',
                description: '从微信对话中提取：明天下午3点前把报告发我',
                status: 'pending',
                dueDate: new Date(Date.now() + 24 * 60 * 60 * 1000),
                dueTime: '15:00',
                source: '微信对话',
                person: '字节跳动 VP',
                urgent: false,
                conflict: false,
                extractedAt: new Date()
            },
            {
                id: 2,
                title: '安排新菜品测试',
                description: '从会议录音中提取：下个月要上新菜，需要测试三次',
                status: 'progress',
                dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
                dueTime: null,
                source: '会议录音',
                person: '产品经理',
                urgent: false,
                conflict: false,
                extractedAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000),
                progress: 1,
                total: 3
            },
            {
                id: 3,
                title: '审核Q1预算报表',
                description: '财务审核部：Q1季度预算报表已生成，核心支出增长12%',
                status: 'pending',
                dueDate: new Date(Date.now() + 2 * 60 * 60 * 1000),
                dueTime: '18:00',
                source: '微信消息',
                person: '财务审核部',
                urgent: true,
                conflict: false,
                extractedAt: new Date(Date.now() - 60 * 60 * 1000)
            },
            {
                id: 4,
                title: '确认排他协议条款',
                description: '关于排他协议，如果无法缩短至3个月，我们可能无法推进Q1预算',
                status: 'completed',
                dueDate: new Date(Date.now() - 1 * 60 * 60 * 1000),
                dueTime: '14:00',
                source: '微信对话',
                person: '字节跳动 VP',
                urgent: false,
                conflict: false,
                extractedAt: new Date(Date.now() - 3 * 60 * 60 * 1000),
                completedAt: new Date(Date.now() - 30 * 60 * 1000)
            },
            {
                id: 5,
                title: '准备下周产品发布会材料',
                description: '从邮件中提取：下周一上午10点需要产品发布会的所有材料',
                status: 'pending',
                dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
                dueTime: '10:00',
                source: '邮件',
                person: '市场总监',
                urgent: false,
                conflict: false,
                extractedAt: new Date(Date.now() - 4 * 60 * 60 * 1000)
            },
            {
                id: 6,
                title: '完成技术架构评审',
                description: 'CTO要求：本周五前完成新系统技术架构的评审工作',
                status: 'progress',
                dueDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000),
                dueTime: '17:00',
                source: '会议记录',
                person: 'CTO',
                urgent: false,
                conflict: false,
                extractedAt: new Date(Date.now() - 6 * 60 * 60 * 1000),
                progress: 2,
                total: 5
            },
            {
                id: 7,
                title: '回复法务部合同审核意见',
                description: '法务部：关于期权回购协议的争议条款，需要您确认是否接受对方提出的修改建议',
                status: 'pending',
                dueDate: new Date(Date.now() + 1 * 60 * 60 * 1000),
                dueTime: '16:30',
                source: '微信消息',
                person: '法务部',
                urgent: true,
                conflict: false,
                extractedAt: new Date(Date.now() - 30 * 60 * 1000)
            },
            {
                id: 8,
                title: '审批核心管理层期权回购申请',
                description: '人事部：核心管理层期权回购申请已提交，请审批',
                status: 'pending',
                dueDate: new Date(Date.now() + 12 * 60 * 60 * 1000),
                dueTime: '09:00',
                source: '微信消息',
                person: '人事部',
                urgent: false,
                conflict: false,
                extractedAt: new Date(Date.now() - 2 * 60 * 60 * 1000)
            },
            {
                id: 9,
                title: '确认技术架构调整方案',
                description: 'CTO：技术架构调整方案已准备，涉及成本增加约15%，需要您决策',
                status: 'pending',
                dueDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000),
                dueTime: null,
                source: '微信对话',
                person: 'CTO',
                urgent: false,
                conflict: false,
                extractedAt: new Date(Date.now() - 8 * 60 * 60 * 1000)
            },
            {
                id: 10,
                title: '安排新员工入职培训',
                description: 'HR部门：下周有3名新员工入职，需要安排培训计划',
                status: 'progress',
                dueDate: new Date(Date.now() + 6 * 24 * 60 * 60 * 1000),
                dueTime: null,
                source: '邮件',
                person: 'HR部门',
                urgent: false,
                conflict: false,
                extractedAt: new Date(Date.now() - 12 * 60 * 60 * 1000),
                progress: 1,
                total: 4
            },
            {
                id: 11,
                title: '完成Q1季度总结报告',
                description: '从会议中提取：月底前需要完成Q1季度业务总结报告',
                status: 'pending',
                dueDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000),
                dueTime: '18:00',
                source: '会议录音',
                person: 'CEO',
                urgent: false,
                conflict: false,
                extractedAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000)
            },
            {
                id: 12,
                title: '处理IDC节点波动后续',
                description: '研发总监：IDC节点出现瞬间波动，已自动执行备用链路切换，需要确认后续处理方案',
                status: 'completed',
                dueDate: new Date(Date.now() - 2 * 60 * 60 * 1000),
                dueTime: '14:00',
                source: '微信消息',
                person: '研发总监 老陈',
                urgent: false,
                conflict: false,
                extractedAt: new Date(Date.now() - 4 * 60 * 60 * 1000),
                completedAt: new Date(Date.now() - 1 * 60 * 60 * 1000)
            }
        ];

        const taskActions = {
            tasks: [...tasksData],
            currentFilter: 'pending',
            
            // 自动提取待办任务（模拟）
            extractTaskFromMessage(message, source, person) {
                const patterns = [
                    {
                        pattern: /(明天|后天|下周一|下周二|下周三|下周四|下周五|下周六|下周日|下个月|(\d+)月(\d+)日|(\d+)\/(\d+)).*?(\d+):(\d+).*?前.*?([^。]+)/,
                        extract: (match) => {
                            const time = match[6] && match[7] ? `${match[6]}:${match[7]}` : null;
                            const task = match[8] || message;
                            return { task, time, date: this.parseDate(match[1]) };
                        }
                    },
                    {
                        pattern: /(需要|要|必须).*?([^。]+)/,
                        extract: (match) => {
                            return { task: match[2], time: null, date: null };
                        }
                    }
                ];
                
                for (const { pattern, extract } of patterns) {
                    const match = message.match(pattern);
                    if (match) {
                        const { task, time, date } = extract(match);
                        return {
                            title: task.trim(),
                            description: `从${source}中提取：${message}`,
                            source: source,
                            person: person,
                            dueTime: time,
                            dueDate: date || new Date(Date.now() + 24 * 60 * 60 * 1000)
                        };
                    }
                }
                
                return null;
            },
            
            parseDate(dateStr) {
                const now = new Date();
                if (dateStr.includes('明天')) {
                    return new Date(now.getTime() + 24 * 60 * 60 * 1000);
                } else if (dateStr.includes('后天')) {
                    return new Date(now.getTime() + 2 * 24 * 60 * 60 * 1000);
                }
                return new Date(now.getTime() + 24 * 60 * 60 * 1000);
            },
            
            // 检测日程冲突
            checkConflict(newTask) {
                const conflicts = this.tasks.filter(task => {
                    if (task.status === 'completed') return false;
                    if (!newTask.dueDate || !task.dueDate) return false;
                    
                    const newDate = new Date(newTask.dueDate);
                    const taskDate = new Date(task.dueDate);
                    
                    return Math.abs(newDate - taskDate) < 2 * 60 * 60 * 1000; // 2小时内冲突
                });
                
                return conflicts.length > 0;
            },
            
            // 添加任务
            addTask(taskData) {
                const newTask = {
                    id: Date.now(),
                    ...taskData,
                    status: 'pending',
                    urgent: taskData.urgent || false,
                    conflict: this.checkConflict(taskData),
                    extractedAt: new Date()
                };
                
                this.tasks.unshift(newTask);
                this.renderTasks();
                this.updateStats();
                
                // 如果有关联的决策任务，可以自动创建
                if (taskData.autoExtracted) {
                    this.showNotification(`已自动提取任务：${newTask.title}`);
                }
            },
            
            // 更新任务状态
            updateTaskStatus(taskId, newStatus) {
                const task = this.tasks.find(t => t.id === taskId);
                if (task) {
                    task.status = newStatus;
                    if (newStatus === 'completed') {
                        task.completedAt = new Date();
                    }
                    this.renderTasks();
                    this.updateStats();
                }
            },
            
            // 筛选任务
            filterTasks(filter) {
                this.currentFilter = filter;
                
                // 更新筛选按钮状态
                document.querySelectorAll('.task-filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.filter === filter) {
                        btn.classList.add('active');
                    }
                });
                
                this.renderTasks();
            },
            
            // 渲染任务列表
            renderTasks() {
                const container = document.getElementById('tasks-list');
                const emptyState = document.getElementById('tasks-empty');
                if (!container) return;
                
                let filteredTasks = this.tasks;
                
                // 应用筛选
                if (this.currentFilter === 'pending') {
                    filteredTasks = filteredTasks.filter(t => t.status === 'pending');
                } else if (this.currentFilter === 'progress') {
                    filteredTasks = filteredTasks.filter(t => t.status === 'progress');
                } else if (this.currentFilter === 'completed') {
                    filteredTasks = filteredTasks.filter(t => t.status === 'completed');
                } else if (this.currentFilter === 'urgent') {
                    filteredTasks = filteredTasks.filter(t => t.urgent);
                }
                
                if (filteredTasks.length === 0) {
                    container.innerHTML = '';
                    if (emptyState) emptyState.classList.remove('hidden');
                    return;
                }
                
                if (emptyState) emptyState.classList.add('hidden');
                
                container.innerHTML = filteredTasks.map(task => {
                    const statusClass = `task-status-${task.status}`;
                    const statusText = {
                        pending: '待处理',
                        progress: '进行中',
                        completed: '已完成'
                    }[task.status];
                    
                    const dueDate = new Date(task.dueDate);
                    const now = new Date();
                    const hoursUntilDue = (dueDate - now) / (1000 * 60 * 60);
                    const isUrgent = hoursUntilDue < 3 && hoursUntilDue > 0;
                    const isOverdue = hoursUntilDue < 0 && task.status !== 'completed';
                    
                    const dueTimeClass = isUrgent || isOverdue ? 'urgent' : '';
                    const dueTimeText = task.dueTime 
                        ? `${this.formatDate(dueDate)} ${task.dueTime}`
                        : this.formatDate(dueDate);
                    
                    const borderClass = task.urgent ? 'task-urgent' : (task.conflict ? 'task-conflict' : 'border-l-2 border-zinc-700/30');
                    
                    return `
                        <div class="glass-card task-card p-4 ${borderClass}" data-task-id="${task.id}">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h3 class="text-sm font-bold text-zinc-200 ${task.status === 'completed' ? 'line-through opacity-60' : ''}">${task.title}</h3>
                                        <span class="task-status-badge ${statusClass}">${statusText}</span>
                                        ${task.urgent ? '<span class="task-status-badge" style="background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3);">紧急</span>' : ''}
                                        ${task.conflict ? '<span class="task-status-badge" style="background: rgba(245, 158, 11, 0.15); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3);">冲突</span>' : ''}
                                    </div>
                                    <p class="text-xs text-zinc-400 mb-2 leading-relaxed">${task.description}</p>
                                    <div class="flex items-center gap-3 text-[10px] text-zinc-500">
                                        <span>来源：${task.source}</span>
                                        <span>·</span>
                                        <span>${task.person}</span>
                                        ${task.progress ? `<span>·</span><span>进度：${task.progress}/${task.total}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/5">
                                <div class="task-due-time ${dueTimeClass}">
                                    ${isOverdue ? '⏰ 已逾期' : `📅 ${dueTimeText}`}
                                </div>
                                <div class="flex gap-2">
                                    ${task.status !== 'completed' ? `
                                        ${task.status === 'pending' ? `
                                            <button onclick="taskActions.updateTaskStatus(${task.id}, 'progress')" class="px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded-lg text-xs font-semibold hover:bg-blue-500/30">开始</button>
                                        ` : ''}
                                        ${task.status === 'progress' ? `
                                            <button onclick="taskActions.updateTaskStatus(${task.id}, 'completed')" class="px-3 py-1.5 bg-[var(--wechat-green)]/20 text-[var(--wechat-green)] rounded-lg text-xs font-semibold hover:bg-[var(--wechat-green)]/30">完成</button>
                                        ` : ''}
                                        <button onclick="taskActions.importToCalendar(${task.id})" class="px-3 py-1.5 bg-zinc-800 text-zinc-400 rounded-lg text-xs font-semibold hover:bg-zinc-700">导入日历</button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            },
            
            // 更新统计
            updateStats() {
                const pending = this.tasks.filter(t => t.status === 'pending').length;
                const progress = this.tasks.filter(t => t.status === 'progress').length;
                const completed = this.tasks.filter(t => t.status === 'completed').length;
                
                const pendingEl = document.getElementById('task-pending-count');
                const progressEl = document.getElementById('task-progress-count');
                const completedEl = document.getElementById('task-completed-count');
                
                if (pendingEl) pendingEl.textContent = pending;
                if (progressEl) progressEl.textContent = progress;
                if (completedEl) completedEl.textContent = completed;
                
                // 检查紧急任务并提醒
                this.checkUrgentTasks();
            },
            
            // 检查紧急任务
            checkUrgentTasks() {
                const now = new Date();
                const urgentTasks = this.tasks.filter(task => {
                    if (task.status === 'completed') return false;
                    const dueDate = new Date(task.dueDate);
                    const hoursUntilDue = (dueDate - now) / (1000 * 60 * 60);
                    return hoursUntilDue < 3 && hoursUntilDue > 0;
                });
                
                // 不再显示通知弹窗
                // if (urgentTasks.length > 0) {
                //     this.showNotification(`有 ${urgentTasks.length} 个任务即将到期`);
                // }
            },
            
            // 导入到日历
            importToCalendar(taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // 生成日历事件数据
                const startDate = new Date(task.dueDate);
                if (task.dueTime) {
                    const [hours, minutes] = task.dueTime.split(':');
                    startDate.setHours(parseInt(hours), parseInt(minutes), 0);
                }
                
                const endDate = new Date(startDate.getTime() + 60 * 60 * 1000); // 默认1小时
                
                // 生成 .ics 文件内容（iCalendar 格式）
                const icsContent = [
                    'BEGIN:VCALENDAR',
                    'VERSION:2.0',
                    'PRODID:-//ShadowPartner//Task Calendar//EN',
                    'BEGIN:VEVENT',
                    `UID:${taskId}@shadowpartner`,
                    `DTSTART:${this.formatICSDate(startDate)}`,
                    `DTEND:${this.formatICSDate(endDate)}`,
                    `SUMMARY:${task.title}`,
                    `DESCRIPTION:${task.description}`,
                    'END:VEVENT',
                    'END:VCALENDAR'
                ].join('\r\n');
                
                // 下载文件
                const blob = new Blob([icsContent], { type: 'text/calendar' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${task.title}.ics`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showNotification(`已导出到日历：${task.title}`);
            },
            
            formatICSDate(date) {
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            },
            
            formatDate(date) {
                const now = new Date();
                const diff = date - now;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                
                if (days === 0) return '今天';
                if (days === 1) return '明天';
                if (days === -1) return '昨天';
                if (days > 0 && days < 7) return `${days}天后`;
                if (days < 0 && days > -7) return `${Math.abs(days)}天前`;
                
                return `${date.getMonth() + 1}月${date.getDate()}日`;
            },
            
            showAddTask() {
                const title = prompt('任务标题：');
                if (!title) return;
                
                const description = prompt('任务描述：', '');
                const dueTime = prompt('截止时间（格式：HH:mm，可选）：', '');
                
                const taskData = {
                    title: title,
                    description: description || title,
                    dueDate: new Date(Date.now() + 24 * 60 * 60 * 1000),
                    dueTime: dueTime || null,
                    source: '手动创建',
                    person: '我',
                    urgent: false
                };
                
                this.addTask(taskData);
            },
            
            showNotification(message) {
                // 简单的通知提示
                const notification = document.createElement('div');
                notification.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 glass-card px-4 py-3 rounded-xl z-[300] border border-[var(--wechat-green)]/50';
                notification.textContent = message;
                notification.style.animation = 'slideDown 0.3s ease';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            },
            
            // 初始化
            init() {
                this.renderTasks();
                this.updateStats();
                
                // 每5分钟检查一次紧急任务
                setInterval(() => {
                    this.checkUrgentTasks();
                }, 5 * 60 * 1000);
            }
        };

        // 初始化渲染知识资产和任务
        document.addEventListener('DOMContentLoaded', () => {
            assetActions.renderAssets();
            taskActions.init();
            chatActions.initWechatReplyBox();
        });
        
        // 从聊天消息中自动提取任务（示例：可以在处理决策时自动提取）
        // 当用户确认发送决策时，可以自动提取其中的任务
        const originalChatSend = chatActions.send;
        chatActions.send = function(id) {
            // 获取任务内容
            const taskEl = document.getElementById(id);
            if (taskEl) {
                const content = taskEl.querySelector('p')?.textContent || '';
                const sender = taskEl.querySelector('span')?.textContent || '';
                
                // 尝试提取任务
                const extractedTask = taskActions.extractTaskFromMessage(content, '决策对话', sender);
                if (extractedTask) {
                    taskActions.addTask({
                        ...extractedTask,
                        autoExtracted: true
                    });
                }
            }
            
            // 执行原始发送逻辑
            originalChatSend.call(this, id);
        };
        
        // 调试：确保chatActions已定义
        console.log('chatActions defined:', typeof chatActions !== 'undefined');
        if (typeof chatActions !== 'undefined') {
            console.log('chatActions.send:', typeof chatActions.send);
        }
        
        // 使用事件监听器绑定按钮点击事件（延迟执行确保DOM已加载）
        setTimeout(function() {
            // 绑定所有发送按钮
            document.querySelectorAll('[id^="send-task-"]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Send button clicked:', this.dataset.taskId);
                    const taskId = this.dataset.taskId;
                    if (typeof chatActions !== 'undefined' && chatActions.send) {
                        chatActions.send(taskId);
                    } else {
                        console.error('chatActions.send not available');
                    }
                });
            });
            
            // 绑定所有修改按钮
            document.querySelectorAll('[id^="edit-task-"]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Edit button clicked:', this.dataset.taskId);
                    const taskId = this.dataset.taskId;
                    if (typeof chatActions !== 'undefined' && chatActions.edit) {
                        chatActions.edit(taskId);
                    } else {
                        console.error('chatActions.edit not available');
                    }
                });
            });
            
            // 也绑定旧的onclick按钮（兼容性）
            document.querySelectorAll('button[onclick*="chatActions.send"]').forEach(btn => {
                const onclick = btn.getAttribute('onclick');
                if (onclick) {
                    btn.removeAttribute('onclick');
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Legacy button clicked');
                        // 检查是否是sendWithReply
                        const replyMatch = onclick.match(/chatActions\.sendWithReply\(['"]([^'"]+)['"]\s*,\s*['"]([^'"]+)['"]\)/);
                        if (replyMatch && replyMatch[1] && replyMatch[2]) {
                            if (typeof chatActions !== 'undefined' && chatActions.sendWithReply) {
                                chatActions.sendWithReply(replyMatch[1], replyMatch[2]);
                            }
                        } else {
                            const match = onclick.match(/chatActions\.send\(['"]([^'"]+)['"]\)/);
                            if (match && match[1]) {
                                if (typeof chatActions !== 'undefined' && chatActions.send) {
                                    chatActions.send(match[1]);
                                }
                            }
                        }
                    });
                }
            });
            
            document.querySelectorAll('button[onclick*="chatActions.edit"]').forEach(btn => {
                const onclick = btn.getAttribute('onclick');
                if (onclick) {
                    btn.removeAttribute('onclick');
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Legacy edit button clicked');
                        const match = onclick.match(/chatActions\.edit\(['"]([^'"]+)['"]\)/);
                        if (match && match[1]) {
                            if (typeof chatActions !== 'undefined' && chatActions.edit) {
                                chatActions.edit(match[1]);
                            }
                        }
                    });
                }
            });
            
            console.log('Button event listeners attached');
        }, 100);
    </script>


</body></html>
