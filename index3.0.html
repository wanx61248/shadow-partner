<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时空镜像 | 跨越千年的命运共振</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        body { background: #030712; color: #f8fafc; font-family: 'PingFang SC', sans-serif; }
        .crystal-card { background: rgba(17, 24, 39, 0.8); backdrop-filter: blur(15px); border: 1px solid rgba(139, 92, 246, 0.2); }
        .gradient-text { background: linear-gradient(135deg, #a78bfa, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .choice-btn { background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.2); transition: all 0.3s; }
        .choice-btn:hover { background: rgba(139, 92, 246, 0.25); transform: translateY(-2px); }
        .chat-container::-webkit-scrollbar { width: 4px; }
        .chat-container::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col items-center justify-start min-h-screen p-4">

    <div id="input-step" class="w-full max-w-md animate__animated animate__fadeIn py-10">
        <h1 class="text-4xl font-black text-center mb-2 gradient-text">时空镜像</h1>
        <p class="text-slate-500 text-center mb-8 text-xs tracking-[0.3em]">TIME MIRROR · 命运重构</p>
        
        <div class="crystal-card rounded-3xl p-8 shadow-2xl">
            <div class="space-y-5">
                <input type="text" id="userName" placeholder="输入你的姓名" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white focus:ring-2 focus:ring-purple-500 outline-none">
                
                <div class="grid grid-cols-2 gap-4">
                    <input type="date" id="birthDate" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white text-sm">
                    <select id="gender" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white">
                        <option value="female">女性</option>
                        <option value="male">男性</option>
                    </select>
                </div>

                <div>
                    <label class="block text-[10px] text-slate-500 mb-2 ml-1 uppercase">出生时辰（选填）</label>
                    <select id="birthHour" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white">
                        <option value="">不详 / 不选择</option>
                        <option value="子">子时 (23:00-01:00)</option>
                        <option value="丑">丑时 (01:00-03:00)</option>
                        <option value="寅">寅时 (03:00-05:00)</option>
                        <option value="卯">卯时 (05:00-07:00)</option>
                        <option value="辰">辰时 (07:00-09:00)</option>
                        <option value="巳">巳时 (09:00-11:00)</option>
                        <option value="午">午时 (11:00-13:00)</option>
                        <option value="未">未时 (13:00-15:00)</option>
                        <option value="申">申时 (15:00-17:00)</option>
                        <option value="酉">酉时 (17:00-19:00)</option>
                        <option value="戌">戌时 (19:00-21:00)</option>
                        <option value="亥">亥时 (21:00-23:00)</option>
                    </select>
                </div>

                <button onclick="startAnalysis()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold py-5 rounded-2xl shadow-lg hover:brightness-110 active:scale-95 transition mt-4">
                    观测命运镜像
                </button>
            </div>
        </div>
    </div>

    <div id="loading-step" class="hidden flex flex-col items-center mt-32">
        <div class="w-16 h-16 border-4 border-purple-500/20 border-t-purple-500 rounded-full animate-spin mb-6"></div>
        <p class="text-purple-400 font-mono animate-pulse tracking-widest">正在拨动时空指针...</p>
    </div>

    <div id="result-step" class="hidden w-full max-w-2xl animate__animated animate__fadeInUp">
        <div class="crystal-card rounded-3xl p-8 mb-8 border-l-4 border-l-purple-500">
            <h2 class="text-amber-400 text-xs font-bold mb-2 tracking-widest uppercase">命盘推演结果</h2>
            <div id="destiny-report" class="text-slate-200 leading-relaxed space-y-4">
                </div>
        </div>
        
        <h3 class="text-center text-slate-500 text-xs mb-6 tracking-widest uppercase">点击下方镜像 · 开启沉浸人生</h3>
        <div id="role-list" class="grid md:grid-cols-3 gap-6"></div>
    </div>

    <div id="drama-step" class="hidden w-full max-w-lg h-[90vh] crystal-card rounded-[2rem] overflow-hidden flex flex-col animate__animated animate__zoomIn">
        <div class="p-5 border-b border-white/5 bg-black/20 flex justify-between items-center">
            <button onclick="location.reload()" class="text-slate-500 text-xs hover:text-white">← 退出</button>
            <span id="active-role-name" class="font-bold text-purple-300">角色名</span>
            <div class="w-8"></div>
        </div>
        
        <div id="chat-box" class="flex-1 p-6 overflow-y-auto space-y-6 chat-container"></div>
        
        <div id="choice-box" class="p-6 bg-black/40 backdrop-blur-md space-y-3"></div>
    </div>

    <script>
        // --- 剧本库逻辑 ---
        const DATABASE = {
            male: [
                { 
                    name: "苏东坡", 
                    report: "你的命格‘财星带印’，天生拥有将苦难转化为艺术的魔力。你现在正处于人生的‘贬谪期’，内心虽有挣扎，但那股豁达的灵性正破土而出。",
                    scenes: [
                        {
                            text: "（公元1082年，黄州。你站在荒芜的东坡地头，手握锄头，肚中空空。）\n苏东坡：‘小友，朝廷不仅夺了我的官位，还想夺了我的胃。这块荒地，咱们是种诗，还是种粮？’",
                            choices: [
                                { t: "种粮！先活下去，自创‘东坡肉’犒劳自己。", next: "下一步，你不仅填饱了肚子，还成了当地的美食博主，百姓爱戴，心境大开。" },
                                { t: "种诗！在这盖个‘雪堂’，请朋友来喝酒写词。", next: "雪堂落成，你写出了《赤壁赋》，虽然身体消瘦，但灵魂已入圣境。" }
                            ]
                        }
                    ]
                },
                {
                    name: "王阳明",
                    report: "‘七杀化印’。你目前面临着极大的外部压力，这种压力并非为了摧毁你，而是为了让你在孤独中‘悟道’。你内心的光明即将照亮至暗时刻。",
                    scenes: [
                        {
                            text: "（贵州龙场。你躺在石棺中，四周是毒虫和瘴气。）\n王阳明：‘圣人之道，吾性自足。小友，若你身处此绝境，是怨天尤人，还是内求本心？’",
                            choices: [
                                { t: "随他去吧，在痛苦中静坐，感受呼吸。", next: "你于半夜惊雷中豁然大悟：‘格物致知，不如致良知！’你创下心学。" },
                                { t: "写信求援，这种鬼地方一分钟也待不下去。", next: "信件石沉大海。你在绝望中明白，唯一的出路只有向上生长。" }
                            ]
                        }
                    ]
                }
            ],
            female: [
                { 
                    name: "李清照", 
                    report: "‘食神配印’，清高且敏锐。你对时代变革的感知远超常人，这种敏感让你痛苦，也让你伟大。你正在寻找那个能承载你情感的容器。",
                    scenes: [
                        {
                            text: "（青州。你与丈夫赵明诚在书斋中，面前是价值连城的金石古物。）\n李清照：‘金兵已破汴京，这些文物是我们半生的心血，也是民族的记忆。弃，还是守？’",
                            choices: [
                                { t: "死守！哪怕颠沛流离，也要带着这些文明的火种。", next: "你带着半车书画南逃，虽然晚景凄凉，但你留下的《金石录》成了永恒。" },
                                { t: "弃物保命！人不在了，东西还有什么意义？", next: "你保全了性命，但在南方的烟雨中，你总会想起那些消失的字画，写下了‘寻寻觅觅，冷冷清清’。" }
                            ]
                        }
                    ]
                }
            ]
        };

        let activeRole = null;

        function startAnalysis() {
            const name = document.getElementById('userName').value;
            if(!name) return alert("请留下姓名。");
            
            document.getElementById('input-step').classList.add('hidden');
            document.getElementById('loading-step').classList.remove('hidden');

            setTimeout(() => {
                const gender = document.getElementById('gender').value;
                const roles = DATABASE[gender];
                
                // 渲染推演结果
                document.getElementById('destiny-report').innerHTML = `
                    <p class="text-xl font-bold text-white">命盘判词：${roles[0].report.split('。')[0]}</p>
                    <p class="text-sm text-slate-400">${roles[0].report.split('。')[1]}</p>
                `;

                // 渲染角色列表
                const roleList = document.getElementById('role-list');
                roleList.innerHTML = '';
                roles.forEach((r, i) => {
                    roleList.innerHTML += `
                        <div onclick="enterDrama('${gender}', ${i})" class="crystal-card p-6 rounded-2xl text-center cursor-pointer hover:border-purple-500 transition shadow-lg">
                            <h4 class="font-bold text-lg">${r.name}</h4>
                            <p class="text-[10px] text-purple-400 mt-2">点击体验剧本</p>
                        </div>
                    `;
                });

                document.getElementById('loading-step').classList.add('hidden');
                document.getElementById('result-step').classList.remove('hidden');
            }, 2000);
        }

        function enterDrama(gender, index) {
            activeRole = DATABASE[gender][index];
            document.getElementById('result-step').classList.add('hidden');
            document.getElementById('drama-step').classList.remove('hidden');
            document.getElementById('active-role-name').innerText = activeRole.name;

            const scene = activeRole.scenes[0];
            showScene(scene);
        }

        function showScene(scene) {
            const chatBox = document.getElementById('chat-box');
            chatBox.innerHTML += `<div class="chat-bubble p-4 text-sm leading-relaxed animate__animated animate__fadeInLeft">${scene.text.replace(/\n/g, '<br>')}</div>`;
            
            const choiceBox = document.getElementById('choice-box');
            choiceBox.innerHTML = '';
            scene.choices.forEach(c => {
                const btn = document.createElement('button');
                btn.className = "choice-btn w-full p-4 rounded-xl text-left text-xs text-slate-200";
                btn.innerText = c.t;
                btn.onclick = () => handleChoice(c);
                choiceBox.appendChild(btn);
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function handleChoice(choice) {
            const chatBox = document.getElementById('chat-box');
            chatBox.innerHTML += `<div class="chat-bubble p-4 text-sm self-end bg-purple-600/30 border border-purple-500/50 ml-12 animate__animated animate__fadeInRight">${choice.t}</div>`;
            
            document.getElementById('choice-box').innerHTML = '';

            setTimeout(() => {
                chatBox.innerHTML += `<div class="chat-bubble p-4 text-sm leading-relaxed border border-white/5 bg-white/5 animate__animated animate__fadeInUp">
                    <b>结局推演：</b><br>${choice.next}<br><br>
                    <span class="text-amber-400">这就是你的时空镜像。即便跨越千年，你依然会做出如此纯粹的选择。</span>
                </div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 800);
        }
    </script>
</body>
</html>
